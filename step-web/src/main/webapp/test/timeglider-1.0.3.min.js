timeglider=window.timeglider||{mode:"publish",version:"0.1.0",ui:{touchtesting:false}};timeglider.TG_Date={};
(function(t){function B(c){return parseInt(c,10)}function x(c){var g=parseInt(c,10);return g>9||g<0?String(c):"0"+g}t=timeglider;var i=jQuery,u={},w={},n={},d={},h={},b=/^(\-?\d+)?(\-\d{1,2})?(\-\d{1,2})?(?:T| )?(\d{1,2})?(?::)?(\d{1,2})?(?::)?(\d{1,2})?(\+|\-)?(\d{1,2})?(?::)?(\d{1,2})?/;t.TG_Date=function(c,g,m){var p,v,a;m=m||0;if(typeof c=="number"){p=v=l.getDateFromSec(c);a=c+m}else if(typeof c!=="object"){if(c=="today")c=l.getToday();p=v=c}if(b.test(p)){c=l.parse8601(p);if(c.tz_ho)c=l.toFromUTC(c,
{hours:c.tz_ho,minutes:c.tz_mi},"to");i.extend(this,c);this.rd=l.getRataDie(this);this.mo_num=this.ye>0?(this.ye-1)*12+this.mo:-1*((Math.abs(this.ye)-1)*12+(12-(this.mo-1)));this.sec=a||(this.rd>0?1:-1)*(Math.abs(this.rd)*86400+this.ho*3600+(this.mi-1)*60);this.date_display=g?g.toLowerCase().substr(0,2):"da";this.dateStr=v}else return{error:"invalid date"};return this};var l=t.TG_Date;l.getTimeUnitSerial=function(c,g){var m=0,p;p=c.ye<0?Math.ceil:Math.floor;switch(g){case "da":m=c.rd;break;case "mo":m=
c.mo_num;break;case "ye":m=c.ye;break;case "de":m=p(c.ye/10);break;case "ce":m=p(c.ye/100);break;case "thou":m=p(c.ye/1E3);break;case "tenthou":m=p(c.ye/1E4);break;case "hundredthou":m=p(c.ye/1E5);break;case "mill":m=p(c.ye/1E6);break;case "tenmill":m=p(c.ye/1E7);break;case "hundredmill":m=p(c.ye/1E8);break;case "bill":m=p(c.ye/1E9)}return m};l.getMonthDays=function(c,g){return l.isLeapYear(g)==true&&c==2?29:l.monthsDayNums[c]};l.twentyFourToTwelve=function(c){var g={};g.ye=c.ye;g.mo=c.mo||1;g.da=
c.da||1;g.ho=c.ho||0;g.mi=c.mi||0;g.ampm="am";if(c.ho>=12){g.ampm="pm";g.ho=c.ho>12?c.ho-12:12}else if(c.ho==0){g.ho=12;g.ampm="am"}else g.ho=c.ho;if(g.mi<9)g.mi="0"+g.mi;return g};l.getMonthAdj=function(c,g){var m=l.getDateFromMonthNum(c);switch(m.mo){case 1:case 3:case 5:case 7:case 8:case 10:case 12:m=Math.floor(g+g/28*3);return{width:m,days:31};case 2:if(l.isLeapYear(m.ye)==true){m=Math.floor(g+g/28);return{width:m,days:29}}else return{width:g,days:28};default:m=Math.floor(g+g/28*2);return{width:m,
days:30}}};l.getDateFromMonthNum=function(c){var g=0;if(c>0){g=c%12;if(g==0)g=12;c=Math.ceil(c/12)}else{g=Math.abs(c)%12;g=12-g+1;if(g==13)g=1;c=-1*Math.ceil(Math.abs(c)/12)}return{ye:c,mo:g}};l.getMonthWidth=function(c,g,m){var p=m/28,v;switch(c){case 1:case 3:case 5:case 7:case 8:case 10:case 12:v=3;break;case 4:case 6:case 9:case 11:v=2;break;case 2:v=l.isLeapYear(g)==true?1:0}return{width:Math.floor(m+p*v),numDays:28+v}};l.getToday=function(){var c=new Date;return c.getUTCFullYear()+"-"+(c.getUTCMonth()+
1)+"-"+c.getUTCDate()+" "+c.getUTCHours()+":"+c.getUTCMinutes()+":"+c.getUTCSeconds()};l.getMonthFromRemDays=function(c,g){var m=0;var p=m=0;m=l.isLeapYear(g)?1:0;if(c<=31){p=1;m=c}else if(c>31&&c<=59+m){p=2;m=c-(31+m)}else if(c>59+m&&c<=90+m){p=3;m=c-(59+m)}else if(c>90+m&&c<=120+m){p=4;m=c-(90+m)}else if(c>120+m&&c<=151+m){p=5;m=c-(120+m)}else if(c>151+m&&c<=181+m){p=6;m=c-(151+m)}else if(c>181+m&&c<=212+m){p=7;m=c-(181+m)}else if(c>212+m&&c<=243+m){p=8;m=c-(212+m)}else if(c>243+m&&c<=273+m){p=
9;m=c-(243+m)}else if(c>273+m&&c<=304+m){p=10;m=c-(273+m)}else if(c>304+m&&c<=334+m){p=11;m=c-(304+m)}else{p=12;m=c-(334+m)}return{mo:p,da:m}};l.getDateFromRD=function(c){if(d[c])return d[c];for(var g=Math.floor(c),m=Math.floor(g/146097)*400,p=g-Math.floor(g/146097)*146097,v=1,a=m+1,e=a+400;a<=e;a++)if(p>365){p-=365;if(l.isLeapYear(a))p-=1;v++}else a=e;m+=v;if(p==0)p=1;p=l.getMonthFromRemDays(p,m);v=(c-g)*1440;g=Math.floor(v%60);v=Math.floor(v/60);if(l.isLeapYear(m)&&p.mo==2)p.da+=1;g=m+"-"+p.mo+
"-"+p.da+" "+v+":"+g+":00";return d[c]=g};l.getDateFromSec=function(c){if(h[c])return h[c];var g=l.getDateFromRD(c/86400);return h[c]=g};l.isLeapYear=function(c){return c%400==0?true:c%100==0?false:c%4==0?true:false};l.getRataDie=function(c){function g(k,j){if(w[k+"-"+j])return w[k+"-"+j];for(var o=0,r=k;r<j;r++)o+=l.isLeapYear(r)?366:365;return w[k+"-"+j]=o}function m(k,j){var o;switch(k){case 1:o=0;break;case 2:o=31;break;case 3:o=59;break;case 4:o=90;break;case 5:o=120;break;case 6:o=151;break;
case 7:o=181;break;case 8:o=212;break;case 9:o=243;break;case 10:o=273;break;case 11:o=304;break;case 12:o=334}if(k>2)if(l.isLeapYear(j))o+=1;return o}var p=c.ye,v=c.mo;c=c.da;var a=0;if(u[p+"-"+v+"-"+c])return u[p+"-"+v+"-"+c];if(p>=0){if(p==0)p=1;a=Math.floor(p/400)*146097;var e=parseInt(g(p-p%400,p)),f=parseInt(m(v,p));a=a+e+f+c-366}else if(p<0)a=l.getBCRataDie({ye:p,mo:v,da:c});return u[p+"-"+v+"-"+c]=a};l.monthNamesLet=["","J","F","M","A","M","J","J","A","S","O","N","D"];l.monthsDayNums=[0,31,
28,31,30,31,30,31,31,30,31,30,31,29];l.units=["da","mo","ye","de","ce","thou","tenthou","hundredthou","mill","tenmill","hundredmill","bill"];l.getBCRataDie=function(c){var g=c.ye,m=c.mo;c=c.da;if(n[g+"-"+m+"-"+c])return n[g+"-"+m+"-"+c];if(m==0)m=1;if(c==0)c=1;var p=-1*((Math.abs(g)-1)*366+[0,335,306,275,245,214,184,153,122,92,61,31,0][m]+(l.monthsDayNums[m]-c+1));return n[g+"-"+m+"-"+c]=p};l.setCulture=function(c){c=t.culture=Globalize.culture(c||"default");l.monthNames=i.merge([""],c.calendar.months.names);
l.monthNamesAbbr=i.merge([""],c.calendar.months.namesAbbr);l.dayNames=c.calendar.days.names;l.dayNamesAbbr=c.calendar.days.namesAbbr;l.dayNamesShort=c.calendar.days.namesShort;l.patterns=c.calendar.patterns};l.prototype={format:function(c,g,m){var p=m||{hours:0,minutes:0};c="da";m=function(v,a){var e=timeglider.TG_Date,f="",k=function(j){j=parseInt(j,10);return j<0?Math.abs(j)+" bce":j};switch(a||"da"){case "no":return"";case "ye":f=k(v.ye);break;case "mo":f=e.monthNamesAbbr[v.mo]+" "+k(v.ye);break;
case "da":f=e.monthNamesAbbr[v.mo]+" "+v.da+", "+k(v.ye);break;case "ho":hoPack=e.twentyFourToTwelve(v);f=e.monthNamesAbbr[v.mo]+" "+v.da+", "+k(v.ye)+" "+hoPack.ho+":"+hoPack.mi+" "+hoPack.ampm}return f};if(g==true){c=this.date_display.substr(0,2);switch(c){case "no":return""}}g=_.clone(this);g=l.toFromUTC(g,p,"from");return timeglider.i18n?timeglider.i18n.formatDate(g,c):g.ye<-27E4?this.ye:m(g,c)}};l.getTimeOffset=function(c){c=c.replace(/[^-\d:]/gi,"");var g=c.split(":"),m=parseInt(g[0],10);g=
parseInt(g[1],10);var p=m+(m<0?-1:1)*(g/60);return{decimal:p,hours:m,minutes:g,seconds:p*3600,string:c}};l.tzOffsetStr=function(c,g){if(c){if(c.length==19)c+=g;else if(c.length==16)c+=":00"+g;return c}};l.parse8601=function(c){var g,m,p,v,a,e,f,k;a=function(j){return j?parseInt(j.replace("-",""),10):0};k=c.match(b);c=parseInt(k[1]);if(!c)return{error:"invalid date; no year provided"};g=a(k[2])||1;m=a(k[3])||1;p=a(k[4])||0;v=a(k[5])||0;a=a(k[6])||0;e=k[7]||"+";f=parseInt(k[8],10)||0;if(e=="-")f*=-1;
k=parseInt(k[9],10)||0;if(e=="-")k*=-1;return{ye:c,mo:g,da:m,ho:p,mi:v,se:a,tz_ho:f,tz_mi:k}};l.getLastDayOfMonth=function(c,g){var m=[0,31,28,31,30,31,30,31,31,30,31,30,31],p=0;return p=g==2&&l.isLeapYear(c)==true?29:m[g]};l.getDateTimeStrings=function(c){var g=l.parse8601(c);if(c=="today"||c=="now")return{date:c,time:""};else c=g.ye+"-"+x(g.mo)+"-"+x(g.da);var m="pm";if(g.ho>=12){if(g.ho>12)g.ho-=12;m="pm"}else{if(g.ho==0)g.ho="12";m="am"}g=B(g.ho)+":"+x(g.mi)+" "+m;return{date:c,time:g}};l.transValidateDateString=
function(c){if(c=="today"||c=="now")return c;if(!c)return false;var g=c.match(/^(\-?\d+|today|now) ?(bce?)?-?(\d{1,2})?-?(\d{1,2})?/);c=l.zeroButt;if(g){var m=g[1],p=g[2]||"",v=g[3]||"07";g=g[4]||"1";if(parseInt(m,10)<0||p.substr(0,1)=="b")m=-1*Math.abs(m);return l.validateDate(m,v,g)?m+"-"+c(v)+"-"+c(g):false}else return false};l.transValidateTimeString=function(c){if(!c)return"12:00:00";c=c.toLowerCase().match(/^(\d{1,2}|noon):?(\d{1,2})?:?(\d{1,2})? ?(am|pm)?/i);var g="";g=l.zeroButt;if(c[1])if(c[0]==
"noon")g="12:00:00";else{var m=parseInt(c[1],10)||12,p=parseInt(c[2],10)||0,v=parseInt(c[3],10)||0;c=c[4]||"am";if(l.validateTime(m,p,v)==false)return false;if(c=="pm"&&m<12)m+=12;else if(c=="am"&&m==12)m=0;g=g(m)+":"+g(p)+":"+g(v)}else g=false;return g};l.validateTime=function(c,g,m){if(c<0||c>23||g<0||g>59||m<0||m>59)return false;return true};l.validateDate=function(c,g,m){var p=l.getMonthDays(g,c);if(m>p||m<=0)return false;if(g>12||g<0)return false;if(c==0)return false;return true};l.zeroButt=
function(c){c=parseInt(c,10);return c>9?String(c):"0"+c};l.toFromUTC=function(c,g,m){var p=0,v=[0,31,28,31,30,31,30,31,31,30,31,30,31,29];p={};if(m=="from"){p.ho=-1*g.hours;p.mi=-1*g.minutes}else if(m=="to"){p.ho=g.hours;p.mi=g.minutes}else{p.ho=-1*c.tz_ho;p.mi=-1*c.tz_mi}if(p.ho==0&&p.mi==0)return c;m=c.ho+c.mi/60+(-1*p.ho+p.mi*-1/60);if(m<0){p=24+m;if(c.da>1)c.da-=1;else if(c.mo==1){c.ye-=1;c.mo=12;c.da=31}else{c.mo-=1;c.da=l.getLastDayOfMonth(c.ye,c.mo)}}else if(m>=24){p=m-24;if(l.isLeapYear(c.ye)&&
c.mo==2&&c.da==28)c.da=29;else if(c.da==v[c.mo]){if(c.mo==12){c.ye+=1;c.mo=1}else c.mo+=1;c.da=1}else c.da+=1}else p=m;v=function(a){a=Math.abs(a);var e=Math.floor(a);return{ho:e,mi:Math.round((a-e)*60),se:0}}(p);c.ho=v.ho;c.mi=v.mi;if(g){c.tz_ho=g.tz_ho;c.tz_mi=g.tz_mi}else{c.tz_ho=0;c.tz_mi=0}return{ye:c.ye,mo:c.mo,da:c.da,ho:c.ho,mi:c.mi,se:c.se}};l.TGSecToUnixSec=function(c){return c-62135661873};l.JSDateToISODateString=function(c){var g=function(m){return m<10?"0"+m:m};return c.getUTCFullYear()+
"-"+g(c.getUTCMonth()+1)+"-"+g(c.getUTCDate())+" "+g(c.getUTCHours())+":"+g(c.getUTCMinutes())+":"+g(c.getUTCSeconds())};l.timezones=[{offset:"-12:00",name:"Int'l Date Line West"},{offset:"-11:00",name:"Bering & Nome"},{offset:"-10:00",name:"Alaska-Hawaii Standard Time"},{offset:"-10:00",name:"U.S. Hawaiian Standard Time"},{offset:"-10:00",name:"U.S. Central Alaska Time"},{offset:"-09:00",name:"U.S. Yukon Standard Time"},{offset:"-08:00",name:"U.S. Pacific Standard Time"},{offset:"-07:00",name:"U.S. Mountain Standard Time"},
{offset:"-07:00",name:"U.S. Pacific Daylight Time"},{offset:"-06:00",name:"U.S. Central Standard Time"},{offset:"-06:00",name:"U.S. Mountain Daylight Time"},{offset:"-05:00",name:"U.S. Eastern Standard Time"},{offset:"-05:00",name:"U.S. Central Daylight Time"},{offset:"-04:00",name:"U.S. Atlantic Standard Time"},{offset:"-04:00",name:"U.S. Eastern Daylight Time"},{offset:"-03:30",name:"Newfoundland Standard Time"},{offset:"-03:00",name:"Brazil Standard Time"},{offset:"-03:00",name:"Atlantic Daylight Time"},
{offset:"-03:00",name:"Greenland Standard Time"},{offset:"-02:00",name:"Azores Time"},{offset:"-01:00",name:"West Africa Time"},{offset:"00:00",name:"Greenwich Mean Time/UTC"},{offset:"00:00",name:"Western European Time"},{offset:"01:00",name:"Central European Time"},{offset:"01:00",name:"Middle European Time"},{offset:"01:00",name:"British Summer Time"},{offset:"01:00",name:"Middle European Winter Time"},{offset:"01:00",name:"Swedish Winter Time"},{offset:"01:00",name:"French Winter Time"},{offset:"02:00",
name:"Eastean EU"},{offset:"02:00",name:"USSR-zone1"},{offset:"02:00",name:"Middle European Summer Time"},{offset:"02:00",name:"French Summer Time"},{offset:"03:00",name:"Baghdad Time"},{offset:"03:00",name:"USSR-zone2"},{offset:"03:30",name:"Iran"},{offset:"04:00",name:"USSR-zone3"},{offset:"05:00",name:"USSR-zone4"},{offset:"05:30",name:"Indian Standard Time"},{offset:"06:00",name:"USSR-zone5"},{offset:"06:30",name:"North Sumatra Time"},{offset:"07:00",name:"USSR-zone6"},{offset:"07:00",name:"West Australian Standard Time"},
{offset:"07:30",name:"Java"},{offset:"08:00",name:"China & Hong Kong"},{offset:"08:00",name:"USSR-zone7"},{offset:"08:00",name:"West Australian Daylight Time"},{offset:"09:00",name:"Japan"},{offset:"09:00",name:"Korea"},{offset:"09:00",name:"USSR-zone8"},{offset:"09:30",name:"South Australian Standard Time"},{offset:"09:30",name:"Central Australian Standard Time"},{offset:"10:00",name:"Guam Standard Time"},{offset:"10:00",name:"USSR-zone9"},{offset:"10:00",name:"East Australian Standard Time"},{offset:"10:30",
name:"Central Australian Daylight Time"},{offset:"10:30",name:"South Australian Daylight Time"},{offset:"11:00",name:"USSR-zone10"},{offset:"11:00",name:"East Australian Daylight Time"},{offset:"12:00",name:"New Zealand Standard Time"},{offset:"12:00",name:"Int'l Date Line East"},{offset:"13:00",name:"New Zealand Daylight Time"}];l.boil=B;l.unboil=x})(timeglider);(function(t){var B=t.levelHeight=12;t.TG_Org=function(){var x=this,i=t.icon_folder;this.blocks=[];this.ids=[];this.vis=[];this.pol=-1;this.placedBlocks=[];this.freshBlocks=[];this.addBlock=function(d,h){d.right=d.left+d.width;d.bottom=d.top+d.height;d.tickScope=h;x.freshBlocks.push(d);x.blocks.push(d)};this.clearFresh=function(){x.freshBlocks=[]};this.getBorg=function(){return this};this.getBlocks=function(){return this.blocks};this.getHTML=function(d){var h=d.tickScope,b=d.ceiling,l=d.laneTops;this.onIZoom=
d.onIZoom;if(h=="sweep")this.vis=[];this.pol=d.inverted?1:-1;this.freshBlocks.sort(u);var c,g,m="",p="";d="";var v=0,a={},e=this.freshBlocks.length;g="";var f=0;c=0;var k=m="",j="";f="";c="lane";var o=j="";c="";k=false;for(var r="",q=0;q<e;q++){a=this.freshBlocks[q];f=0;o=j="";k=false;if(a.tickScope==h)if(_.indexOf(this.vis,a.id)==-1){this.vis.push(a.id);if(a.html&&a.html.substr(0,4)=="<div")d+="<div style='position:relative; left:"+a.left+"px' id='"+a.id+"'>"+a.html+"</div>";else{if(a.image){c=a.image.display_class;
m=a.shape&&c=="inline"?" style='width:"+a.shape.img_wi+"px;height:auto;top:-"+a.shape.img_ht+"px'":"";f=0;m="<div data-max_height='"+a.image.max_height+"' class='timeglider-event-image-"+c+"'><img src='"+a.image.src+"' "+m+"></div>"}else m="";c=b-30;if(this.onIZoom&&a.y_position>0)a.top=x.pol*a.y_position;else if(typeof l[a.lane]=="number"&&typeof a.lane=="string")try{a.top=x.pol*l[a.lane];k=true;o=" lane-event"}catch(s){debug.log("err:",s)}else{a.attempts=0;n(a,c)}if(c=x.pol==-1?b&&Math.abs(a.top)>
c:b&&Math.abs(a.top+30)>c){f=x.pol==-1?"top:-"+(b-10)+"px":"top:"+b+"px";j="<img src='"+i+"shapes/circle_white.png'>";j=a.icon?"<img src='"+i+a.icon+"'>":j;d+="<div id='"+a.id+"' class='timeglider-timeline-event tg-event-overflow' style='left:"+a.left+"px;"+f+"'>"+j+"</div>"}else if(a.fontsize>2){g=a.span_color?";background-color:"+a.span_color:"";a.fontsize<10?a.opacity=a.fontsize/10:a.opacity=1;if(a.selected)j="selected";if(a.span==true){c="timeglider-event-spanning";r=k?"<span>"+a.title+"</span>":
"";g="<div data-starts='"+a.startdateObj.sec+"' data-ends='"+a.enddateObj.sec+"' class='timeglider-event-spanner' style='top:px;height:"+a.fontsize+"px;width:"+a.spanwidth+"px"+g+"'>"+r+"</div>"}else g=c="";p=a.icon?"<img class='timeglider-event-icon' src='"+i+a.icon+"' style='height:"+a.fontsize+"px;left:-"+(a.fontsize+2)+"px; top:"+f+"px'>":"";k||(v=x.pol===1?30:-8);k=a.css_class||"";d+="<div class='timeglider-timeline-event "+k+" "+c+o+" "+j+"' id='"+a.id+"' style='width:"+a.width+"px;height:"+
a.height+"px;left:"+a.left+"px;opacity:"+a.opacity+";top:"+(a.top+v)+"px;font-size:"+a.fontsize+"px;'>"+p+m+g;r||(d+="<div class='timeglider-event-title' style='top:"+f+"px'>"+a.title+"</div>");d+="</div>"}}}}return{html:d}};var u=function(d,h){var b=h.importance,l=d.importance;if(d.image&&h.image)return-1;return b<l?-1:b>l?1:0},w=function(d,h){if(h.shape)if(w(d,h.shape)==true)return true;if(!(h.left+-16>d.right||h.right<d.left+-16||h.bottom<d.top+-6))if(h.left>=d.left&&h.left<=d.right||h.right>=
d.left&&h.right<=d.right||h.right>=d.right&&h.left<=d.left||h.right<=d.right&&h.left>=d.left)if(h.bottom<=d.bottom&&h.bottom>=d.top||h.top<=d.bottom&&h.top>=d.top||h.bottom==d.bottom&&h.top==d.top)return true;return false},n=function(d,h){var b=false,l=x.placedBlocks,c=x.placedBlocks.length,g=false;if(c==0||Math.abs(d.top)>h)g=false;else for(var m=0;m<c;m++){sh=false;b=w(l[m],d);if(d.shape)sh=w(l[m],d.shape);if(b==true||sh==true){if(x.pol===-1){d.top-=B;d.bottom-=B;if(d.shape){d.shape.top-=B;d.shape.bottom-=
B}}else{d.top+=B;d.bottom+=B;if(d.shape){d.shape.top+=B;d.shape.bottom+=B}}d.attempts++;n(d,h);g=true;break}}if(g==false){x.placedBlocks.push(d);d.shape&&x.placedBlocks.push(d.shape)}}};t.TG_OrgList=function(x,i){var u=t.icon_folder;this.blocks=x;this.ids=[];this.mediator=i;this.getHTML=function(){var w,n="",d="",h="",b="",l="";b="";var c={};l="";for(var g=this.blocks.length,m="",p=0;p<g;p++){c=this.blocks[p];n=c.image?"<div class='tg-event-list-img'><img src='"+c.image.src+"'></div>":"";b_span_color=
c.span_color?";background-color:"+c.span_color:"";c.fontsize<10?c.opacity=c.fontsize/10:c.opacity=1;w=c.span==true?"timeglider-event-spanning":"";icon_img=c.icon?"<img src='"+u+c.icon+"'>":"";d="<div class='tg-event-list-icon'>"+icon_img+"&nbsp;</div>";m=c.css_class||"";if(c.description){l=c.description.replace(/(<([^>]+)>)/ig,"");b=l.length>110?"...":"";b="<div class='tg-list-blurb'>"+l.substr(0,110)+b+"</div>"}else b="";l=c.startdateObj.format("",true,this.mediator.timeOffset);h+="<li class='tg-list-li timeglider-timeline-event clearfix"+
m+" "+w+"' id='"+c.id+"'><div class='tg-list-dateline timeglider-dateline-startdate'>"+l+"</div>"+n+d+"<div class='timeglider-event-title'>"+c.title+"</div>"+b+"</li>"}return{html:h}}}})(timeglider);(function(t){var B=t.TG_Date,x=jQuery,i={},u=B.units,w;t.TG_EventCollection=Backbone.Collection.extend({eventHash:{},comparator:function(n){return n.get("startdateObj").sec},setTimelineHash:function(n,d){this.eventHash[n]=d},getTimelineHash:function(n){return this.eventHash[n]},model:t.TG_Event});t.adjustAllTitleWidths=function(n){_.each(n.models,function(d){var h=t.getStringWidth(d.get("title"));d.set({titleWidth:h})})};t.TG_Event=Backbone.Model.extend({urlRoot:"/event",defaults:{title:"Untitled",
selected:false,css_class:""},initialize:function(n){if(n.image){if(typeof n.image=="string")n.image={id:n.id,scale:n.image_scale||100,src:n.image,display_class:n.image_class||"lane",width:n.image_width||0,height:n.image_height||0};else{n.image.display_class=n.image.display_class||"lane";n.image.width=0;n.image.height=0;n.image.scale=n.image.scale||100}this.getEventImageSize(n.image,n)}else n.image="";n.title=n.title.replace(/&amp;/g,"&");n.description=n.description||"";n.titleWidth=t.getStringWidth(n.title);
n.y_position=n.y_position||0;this.set(n)},getEventImageSize:function(n,d){function h(c,g){return function(){return g.apply(c,arguments)}}var b=this,l=new Image;l.src=n.src;l.onerror=h(l,function(){t.app&&typeof t.app.reportMissingImage=="function"&&t.app.reportMissingImage(n.src,d);b.set({image:{src:n.src,status:"missing"}})});l.onload=h(l,function(){b.get("image").height=this.height;b.get("image").width=this.width;b.get("image").max_height=this.height})},reIndex:function(n){var d=this,h=n||false,
b=d.get("cache"),l=d.get("id"),c=d.get("startdateObj"),g=d.get("enddateObj"),m=d.get("timelines"),p=b.startdateObj||c,v={},a={},e=0,f=0;n=_.union(b.timelines,m);var k=t.TG_Date,j=d.get("mediator"),o=j.timelineCollection,r=j.eventCollection;_.each(n,function(q){v=o.get(q);a=r.getTimelineHash(q);a.all=_.reject(a.all,function(A){return A==l});_.each(k.units,function(A){e=k.getTimeUnitSerial(p,A);if(a[A][e]!==undefined)a[A][e]=_.reject(a[A][e],function(C){return C==l});if(h!=true)if(x.inArray(q,m)!=-1){f=
k.getTimeUnitSerial(c,A);if(a[A][f]!==undefined)a[A][f].push(l);else a[A][f]=[l]}});h!=true&&x.inArray(q,m)!=-1&&a.all.push(l);v.get("bounds");var s=[];_.each(a.all,function(A){A=r.get(A);s.push(A.get("startdateObj").sec);s.push(A.get("enddateObj").sec)});v.set({bounds:{first:_.min(s),last:_.max(s)}});var y=v.get("spans");b.span&&delete y["s_"+l];if(h!=true)if(d.get("span")==true)y["s_"+l]={id:l,start:c.sec,end:g.sec};v.set({has_events:a.all.length})})}});t.TG_Timeline=Backbone.Model.extend({urlRoot:"/timeline",
defaults:{initial_zoom:25,timezone:"00:00",title:"Untitled",with_events:true,events:[],legend:[],tags:{}},_chewTimeline:function(n){w=n.mediator;n.timeline_id=n.id;i=w.options;var d={all:[],da:[],mo:[],ye:[],de:[],ce:[],thou:[],tenthou:[],hundredthou:[],mill:[],tenmill:[],hundredmill:[],bill:[]};n.spans={};n.hasImageLane=false;n.startSeconds=[];n.endSeconds=[];n.initial_zoom=parseInt(n.initial_zoom,10)||25;n.inverted=n.inverted||false;n.size_importance=n.size_importance=="false"||n.size_importance==
"0"?0:1;n.is_public=n.is_public=="false"||n.is_public=="0"?0:1;n.timeOffset=B.getTimeOffset(n.timezone||"00:00");if(!n.color)n.color="#333333";if(n.events.length>0&&!n.preload){for(var h,b,l,c,g=n.events.length,m=0;m<g;m++){b=n.events[m];b.css_class=b.css_class||"";if(b.id)l=b.id;else b.id=l="anon"+this.anonEventId++;b.importance=parseInt(b.importance,10)+i.boost;b.low_threshold=b.low_threshold||1;b.high_threshold=b.high_threshold||100;if(b.map)if(w.main_map){if(timeglider.mapping.ready)b.map.marker_instance=
timeglider.mapping.addAddMarkerToMap(b,w.main_map)}else t.googleMapsLoad();b.callbacks=b.callbacks||{};h=typeof b.date_display=="object"?"da":b.date_display||b.date_limit||"da";b.date_display=h.toLowerCase().substr(0,2);if(b.link){if(typeof b.link=="string"&&b.link.substr(0,4)=="http")b.link=[{url:b.link,label:"link"}]}else b.link="";b.date_display=h.toLowerCase().substr(0,2);b.keepCurrent=0;if(b.startdate.substr(0,10)=="7777-12-31"||b.startdate.substr(0,10)=="8888-12-31"||b.startdate=="now"||b.startdate==
"today"){b.startdate=B.getToday();if(b.startdate=="now"||b.startdate=="8888-12-31"){b.keepCurrent+=1;b.css_class+=" ongoing"}}b.zPerp="0";if(typeof b.enddate=="string"&&(b.enddate.substr(0,10)=="7777-12-31"||b.enddate.substr(0,10)=="8888-12-31"||b.enddate=="now"||b.enddate=="today")){b.enddate=B.getToday();if(b.enddate=="now"||b.enddate=="8888-12-31"){b.keepCurrent+=2;b.css_class+=" ongoing"}}if(n.timeOffset.seconds){b.startdate=B.tzOffsetStr(b.startdate,n.timeOffset.string);if(b.enddate)b.enddate=
B.tzOffsetStr(b.enddate,n.timeOffset.string)}b.startdateObj=new B(b.startdate,b.date_display);if(b.enddate&&b.enddate!==b.startdate){b.enddateObj=new B(b.enddate,b.date_display);b.span=true;n.spans["s_"+b.id]={id:b.id,start:b.startdateObj.sec,end:b.enddateObj.sec}}else{b.enddateObj=b.startdateObj;b.span=false}if(b.image)if(b.image.display_class!="inline")n.hasImageLane=true;n.startSeconds.push(b.startdateObj.sec);n.endSeconds.push(b.enddateObj.sec);b.cache={timelines:[n.timeline_id],span:b.span,startdateObj:_.clone(b.startdateObj),
enddateObj:_.clone(b.enddateObj)};b.icon=!b.icon||b.icon==="none"?"":b.icon;if(!isNaN(b.startdateObj.sec)&&!isNaN(b.enddateObj.sec)){d.all.push(l);for(var p=u.length,v=0;v<p;v++){h=u[v];c=B.getTimeUnitSerial(b.startdateObj,h);if(d[h][c]!==undefined)_.indexOf(d[h][c],l)===-1&&d[h][c].push(l);else d[h][c]=[l]}b.mediator=w;if(w.eventCollection.get(l))w.eventCollection.get(l).get("timelines").push(n.timeline_id);else{b.timelines=[n.timeline_id];b=new t.TG_Event(b);w.eventCollection.add(b)}}}g=x.merge(n.startSeconds,
n.endSeconds);g=_.sortBy(g,function(a){return parseInt(a)});n.bounds={first:_.first(g),last:_.last(g)};g=B.getDateFromSec(n.bounds.first);n.focus_date=n.focus_date||g;n.focusDateObj=new B(n.focus_date);n.has_events=1}else{n.tags=n.tags||{test:1};n.focus_date=n.focus_date||"today";n.focusDateObj=new B(n.focus_date);n.bounds={first:n.focusDateObj.sec,last:n.focusDateObj.sec+86400};n.has_events=0}n.hasLegend=n.legend.length>0?true:false;if(n.lanes&&n.lanes.length>0){n.hasLanes=true;n.useLanes=true}else{n.hasLanes=
false;n.useLanes=false}n.display="expanded";w.eventCollection.setTimelineHash(n.timeline_id,d);delete n.events;return n},initialize:function(n){this.set(this._chewTimeline(n));this.bind("change",function(){})}})})(timeglider);(function(t){var B=t.TG_Date,x="",i="",u={},w=0,n=0,d=0,h="",b=jQuery,l={},c="",g,m,p=b.support.touch?"touchstart":"click",v=function(a){if(typeof a=="number")return a;if(!a)return 0;return parseInt(a.replace("px",""),10)};t.TG_TimelinePlayer=function(a,e){var f=this;i=e;i.viewMode="timeline";u=e.options;x="#"+a._id;c=a._id;h=u.base_namespace+"#"+c;this.titleBar=true;this.singleTitleHeight=0;i.setImageLaneHeight(u.image_lane_height,false,true);this._views={PLACE:x,CONTAINER:x+" .timeglider-container",
SCRIM:x+" .tg-scrim",DATE:x+" .tg-footer-center",HEADER:x+" .tg-widget-header",FOCUS_DATE:x+" .tg-date-display",TIMELINE_MENU:x+" .timeglider-timeline-menu",TIMELINE_MENU_UL:x+" .timeglider-timeline-menu ul",TIMELINE_LIST_BT:x+" .timeglider-list-bt",SLIDER_CONTAINER:x+" .timeglider-slider-container",SLIDER:x+" .timeglider-slider",ZOOM_DISPLAY:x+" .timeglider-zoomlevel-display",TRUCK:x+" .timeglider-truck",CENTERLINE:x+" .timeglider-centerline",TICKS:x+" .timeglider-ticks",HANDLE:x+" .timeglider-handle",
FOOTER:x+" .timeglider-footer",FILTER_BT:x+" .timeglider-filter-bt",FILTER_BOX:x+" .timeglider-filter-box",SETTINGS_BT:x+" .timeglider-settings-bt"};g=this._views.CONTAINER;m=this._views.TICKS;this.ticksHandleOffset=this.rightside=this.leftside=this.tickNum=this.dragSpeed=0;this.timeoout_id=1;this.sliderActive=false;this.ztop=1E3;this.filterBoxActivated=false;this.tick_height=32;this._templates={};this._templates={test:"testola",event_modal_small:"<div class='tg-modal timeglider-ev-modal ui-widget-content ${extra_class}' id='${id}_modal'><div class='tg-close-button tg-close-button-remove'></div><div class='dateline'>{{html dateline}}</div><h4 id='title'>${title}</h4><div class='tg-ev-modal-description jscroll'><p>{{html image}}{{html description}}</p></div><ul class='timeglider-ev-modal-links'>{{html links}}</ul></div>",
event_modal_iframe:"<div class='tg-modal timeglider-ev-modal ui-widget-content tg-iframe-modal' id='${id}_modal'><div class='tg-close-button tg-close-button-remove'></div><div class='dateline'>{{html dateline}}</div><h4 id='title'>{{html title}}</h4><iframe frameborder='none' src='${link}'></iframe></div>",event_modal_full:b.template(null,"<div class='tg-modal tg-full_modal' id='ev_${id}_modal'><div class='tg-full_modal_scrim'></div><div class='tg-full_modal_panel'><div class='tg-close-button tg-full_modal_close'></div><div class='tg-full_modal_content'><div class='dateline'>{{html dateline}}</div><h4>${title}</h4><div class='tg-full_modal-vidimg'></div><div class='tg-full_modal-body'>{{html image}}{{html description}}</div><div class='tg-full_modal-links'><ul>{{html links}}</ul></div></div>"),
filter_modal:b.template(null,"<div class='tg-modal timeglider-filter-box'><div class='tg-close-button'></div><h3>search/filter</h3><div class='timeglider-menu-modal-content'><div class='timeglider-formline'><input placeholder='keyword(s)' type='text' class='timeglider-filter-search'></div><div class='tg-filter-cbs'><input type='checkbox' id='filter_t' checked><label for='filter_t'>title</label>&nbsp;&nbsp;&nbsp;<input type='checkbox' id='filter_d'><label for='filter_d'>description</label></div><div class='timeglider-formline filter-tags'><input type='text' id='filter-tags' class='timeglider-filter-tags'></div><ul class='buttons'><li class='timeglider-filter-apply'>go</li><li class='timeglider-filter-clear'>clear</li></ul></div><div class='tg-modal-corner tg-modal-corner-south'></div>"),
timeline_list_modal:b.template(null,"<div class='tg-modal timeglider-timeline-menu'><div class='tg-close-button'></div><h3>timelines</h3><div class='timeglider-menu-modal-content'><ul></ul></div><div class='tg-modal-corner tg-modal-corner-south'></div>"),settings_modal:b.template(null,"<div class='tg-modal timeglider-settings-modal'><div class='tg-close-button'></div><h3>settings</h3><div class='timeglider-menu-modal-content'><div class='timeglider-settings-timezone'></div></div><div class='tg-modal-corner tg-modal-corner-south'></div>"),
legend_modal:b.template(null,"<div class='timeglider-menu-modal tg-legend tg-display-none'  id='${id}'><div class='tg-close-button-small tg-legend-close'></div><div class='timeglider-menu-modal-content'><ul id='${id}'>{{html legend_list}}</ul><div class='tg-legend-controls'><span class='tg-legend-all'>all</span><span class='tg-legend-none'> | none</span></div></div></div>")};this.timelineInfoModal=Backbone.View.extend({tagName:"div",model:t.TG_Timeline,className:"tg-modal tg-timeline-modal ui-widget-content",
events:{"click .tg-close":"remove","click .tg-timeline-start":"timelineStart","click .tg-modal-tags":"openTagsInfo"},template:function(){var j="",o="";o="";var r=[],q=this.model.get("tags");if(_.size(q)>0){j="<li class='tg-modal-tags'></li>";_.each(q,function(s,y){r.push(y+" ("+s+")")});o="<div class='tg-modal-tags-info'><p class='tags-intro'>Use the search tool (at lower right) to filter this timeline according to these tags:</p>"+r.join(", ")+"</div>"}return"<h4>${title}</h4><div class='tg-close tg-close-button'></div><div class='tg-timeline-description jscroll'>{{html description}}</div><ul>"+
j+"<li data-timeline_id='"+this.model.get("id")+"' class='tg-timeline-start'>start</li></ul>"+o+"<div class='tg-modal-corner tg-modal-corner-north'></div>"},openTagsInfo:function(){b(this.el).find(".tg-modal-tags-info").is(":visible")?b(this.el).find(".tg-modal-tags-info").slideUp():b(this.el).find(".tg-modal-tags-info").slideDown()},timelineStart:function(){i.focusTimeline(this.model.get("id"));this.remove()},initialize:function(){},render:function(){b(this.el).html(b.tmpl(this.template(),this.model.attributes)).attr("id",
this.model.get("id")+"_timelineInfoModal");return this},remove:function(){b(this.el).fadeOut()}});this.presInfoModal=Backbone.View.extend({tagName:"div",model:t.TG_Timeline,className:"tg-modal tg-timeline-modal tg-pres-modal ui-widget-content",events:{"click .tg-close":"remove","click .tg-pres-start":"presStart"},template:function(){return"<div class='tg-timeline-description jscroll'>{{html description}}</div><ul><li class='tg-close'>close</li><li class='tg-pres-start'>start</li></ul><div class='tg-modal-corner tg-modal-corner-north'></div>"},
presStart:function(){var j=i.presentation;i.gotoDateZoom(j.focus_date.dateStr,j.initial_zoom)},render:function(){b(this.el).html(b.tmpl(this.template(),this.model)).attr("id","presInfoModal");return this},remove:function(){b(this.el).remove()}});this.datepicker=Backbone.View.extend({tagName:"div",className:"tg-modal tg-datepicker",events:{"click .tg-close-button":"remove","click .goto-save":"gotoDate","keydown .dateinput":"doKeydown"},template:function(){return"<div class='tg-close-button'></div><h3>Go to...</h3><div class='timeglider-menu-modal-content'><div class='tg-dtinput-wrap' id='goto-wrap'> <input class='mousetrap dateinput' type='text' id='goto' value='"+
i.getFocusDate().dateStr.split(" ")[0]+"'><div class='goto-save save button' id='goto-go'>go</div><div class='cal_icon'></div></div></div>"},doKeydown:function(j){switch(j.which){case 0:case 9:case 13:this.gotoDate()}},gotoDate:function(){var j=b(this.el).find("input.dateinput").val();i.gotoDateZoom(j);this.remove()},render:function(){b(this.el).html(b.tmpl(this.template(),this.model)).attr("id","datepickerModal");b(this.el).find("#goto-wrap").timegliderDatePicker({is_touch_device:false,position:{my:"left bottom",
at:"left top",collision:"none"}});return this},remove:function(){b(this.el).remove();f.datepickerOpen=false}});b(g).delegate(".timeline-info-bt",p,function(){var j=b(this).data("timeline_id");f.timelineModal(j)}).delegate(".tg-expcol-bt",p,function(){var j=b(this).data("timeline_id");f.expandCollapseTimeline(j)}).delegate(".tg-invert-bt",p,function(){var j=b(this).data("timeline_id");f.invertTimeline(j)}).delegate(".tg-legend-bt",p,function(){var j=b(this).data("timeline_id");f.legendModal(j)}).delegate(".tg-close-button-remove",
p,function(){b(this).parent().remove()}).delegate(".tg-full_modal_scrim, .tg-full_modal_close",p,function(){b(".tg-full_modal").remove()}).delegate(".tg-event-overflow",p,function(){i.zoom(-1)}).delegate(".tg-event-overflow","hover",function(){}).delegate(".tg-legend-close",p,function(){var j=b(g+" .tg-legend");j.fadeOut(300,function(){j.remove()});i.setFilters({origin:"legend",icon:"all"},[])}).delegate(".tg-legend-all",p,function(){var j=b(this).closest(".tg-legend").attr("id"),o=[];if(j=="pres"||
timeglider.mode=="presentation")o=_.pluck(i.presentation.legend,"icon");else{j=i.timelineCollection.get(j);o=_.pluck(j.get("legend"),"icon")}if(u.legend.type==="checkboxes"){i.setFilters({origin:"legend",icon:"provided"},o);b(g+" .tg-legend li").each(function(){b(this).addClass("tg-legend-icon-selected")})}else{i.setFilters({origin:"legend",icon:"all"});b(g+" .tg-legend li").each(function(){b(this).removeClass("tg-legend-icon-selected")})}}).delegate(".tg-legend-none",p,function(){b(g+" .tg-legend li").each(function(){b(this).removeClass("tg-legend-icon-selected")});
i.setFilters({origin:"legend",icon:"none"})}).delegate(".tg-timeline-start",p,function(){var j=b(this).data("timeline_id");i.focusTimeline(j)}).delegate(".tg-prev",p,function(){i.gotoPreviousEvent(true)}).delegate(".tg-next",p,function(){i.gotoNextEvent(true)}).delegate(".timeglider-tick",p,function(j){j=i.getDateFromOffset(j.pageX);i.gotoDateZoom(j.dateStr)}).delegate(".tg-pres-start",p,function(){f.startPresentation()}).delegate(".pres-info-bt",p,function(){f.presentationModal()}).delegate(".tg-pres-header h2",
p,function(){if(b(this).data("timeline_id")=="primary"){f.startPresentation();f.presentationModal()}else alert("Drill baby, drill!")}).delegate(".tg-title-prev-events",p,function(){i.gotoPreviousEvent(true)}).delegate(".tg-title-next-events",p,function(){i.gotoNextEvent(true)}).css("height",b(x).height());b(".tg-zoom-in").bind(p,function(){i.zoom(-1)});b(".tg-zoom-out").bind(p,function(){i.zoom(1)});b(this._views.FOCUS_DATE).bind(p,function(){f.datepickerModal()});b(window).resize(_.throttle(function(){i.resize()},
700));i.base_font_size=u.base_font_size;u.show_footer==false&&b(this._views.FOOTER).css("display","none");this.dimensions=i.dimensions=this.getWidgetDimensions();this.initTimelineVOffset=this.dimensions.container.height-(this.dimensions.footer.height+this.dimensions.tick.height+18);this.buildSlider();this.setupScroller();this.setPanButton(b(".timeglider-pan-right"),-30);this.setPanButton(b(".timeglider-pan-left"),30);b(this._views.TRUCK).bind("dblclick",function(j){i.registerUIEvent({name:"dblclick",
event:j})}).bind("mousewheel",function(j,o){i.mousewheelChange(-1*(o<0?Math.floor(o):Math.ceil(o)));if(u.mousewheel!=="none")return false});b(m).draggable({axis:"x",start:function(){f.eventUnHover()},containment:[-2E4,0,2E4,0],cancel:".tg-modal",drag:function(){n=Math.floor(b(this).position().left);i.setTicksOffset(n);w=n-d;d=n;return true},stop:function(){f.resetTicksHandle();f.registerDragging();f.registerTitles()}}).delegate(".timeglider-timeline-event",p,function(){var j=b(this);f.eventUnHover(j);
var o=j.attr("id"),r=i.eventCollection.get(o).attributes;if(timeglider.mode!="authoring")if(r.drilldown)i.drilldown(r);else if(r.click_callback)try{var q=r.click_callback.split("."),s=q.length,y=true;if(s==1)y=window[q[0]](r);else if(s==2)y=window[q[0]][q[1]](r);else if(s==3)y=window[q[0]][q[1]][q[2]](r);y!==false&&f.eventModal(o,j)}catch(A){debug.log(r.click_callback+" method cannot be found",A)}else{q=true;if(typeof i.options.eventClick=="function")q=i.options.eventClick(j,r,this);q&&f.eventModal(o,
j)}}).delegate(".timeglider-timeline-event","mouseover",function(){f.eventUnHover();var j=i.eventCollection.get(b(this).attr("id")).attributes;f.eventHover(b(this),j)}).delegate(".timeglider-timeline-event","mouseout",function(){i.eventCollection.get(b(this).attr("id"));f.eventUnHover(b(this))}).delegate(".tg-event-collapsed","hover",function(){});f.resizeElements();b.subscribe(h+".mediator.ticksOffsetChange",function(){f.tickHangies();f.registerDragging();f.registerTitles()});b.subscribe(h+".viewer.rendered",
function(){});b.subscribe(h+".mediator.mousewheelChange",function(j){if(j.action==="pan"){f.pan(j.dir*10);f.throttledResetTicksHandle()}});b.subscribe(h+".mediator.focusToEvent",function(){});b.subscribe(h+".mediator.imageLaneHeightSetUi",function(){f.setImageLaneHandle()});b.subscribe(h+".mediator.zoomLevelChange",function(){f.tickNum=0;f.leftside=0;var j=i.getZoomLevel();b(f._views.SLIDER).slider("value",f.invSliderVal(j));f.displayZoomLevel(j);f.castTicks("zoomLevelChange")});b.subscribe(h+".mediator.initialScope",
function(){var j=i.getInitialScope(),o=j.left_sec,r=j.right_sec,q=j.spp,s=b(g).offset(),y=b(g).width();o=Math.floor((o-j.timelineBounds.first)/q)+s.left+y/2;j=-1*Math.ceil((j.timelineBounds.last-r)/q)+s.left-y/2;u.constrain_to_data&&i.activeTimelines.length>0&&b(m).draggable("option","containment",[j,0,o,0])});b.subscribe(h+".mediator.ticksReadySignal",function(){i.ticksReady===true&&f.freshTimelines()});b.subscribe(h+".mediator.refreshSignal",function(){f.tickNum=0;f.leftside=0;f.castTicks("refreshSignal")});
b.subscribe(h+".mediator.ticksArrayChange",function(){});b.subscribe(h+".mediator.scopeChange",function(){i.getScope();i.scopeChanges==1&&f.initiateNavigation();i.scopeChanges++});b.subscribe(h+".mediator.focusDateChange",function(){f.displayFocusDate()});b.subscribe(h+".mediator.timelineDataLoaded",function(){if(i.singleTimelineID)f.setupSingleTimeline();else{f.buildTimelineMenu(i.timelineCollection);timeglider.mode=="presentation"&&f.setupPresentation()}f.buildSettingsMenu();f.setupFilter();b(".timeglider-loading").fadeOut(500)});
b.subscribe(h+".mediator.activeTimelinesChange",function(){b(f._views.TIMELINE_MENU_UL+" li").each(function(){var j=b(this).data("timeline_id");_.indexOf(i.activeTimelines,j)!=-1?b(this).addClass("activeTimeline"):b(this).removeClass("activeTimeline")})});b.subscribe(h+".mediator.filterChange",function(){});b.subscribe(h+".mediator.resize",function(){f.resize()});if(b.support.touch){b("#"+c).addTouch();var k=document.getElementById(c);k.addEventListener("gesturestart",function(j){j.preventDefault();
b("#output").append("<br>gesture zoom:"+i.getZoomLevel())},false);k.addEventListener("gestureend",function(j){j.preventDefault();b("#output").append("<br>gesture end:"+i.getZoomLevel())},false);k.addEventListener("gesturechange",function(j){j.preventDefault();j.preventDefault();if(i.gesturing===false){i.gesturing=true;i.gestureStartZoom=i.getZoomLevel()}i.setZoomLevel(Math.ceil(i.gestureStartZoom/(j.scale/2)))},false)}};t.TG_TimelinePlayer.prototype={resize:function(){var a=b(x).height();b(g).height(a);
this.dimensions=this.getWidgetDimensions();this.resizeElements();i.refresh()},getWidgetDimensions:function(){var a=b(g),e=a.width(),f=Math.floor(e/2)+1,k=a.height(),j=Math.floor(k/2),o=this.tick_height,r=a.position().left;a=a.offset();var q=u.show_footer==true?b(this._views.FOOTER).outerHeight():0,s=k-q-o,y=k-(q+o);h_height=b(this._views.HEADER).outerHeight()||0;e={container:{width:e,height:k,centerx:f,centery:j,left:r,offset:a},ticks:{height:y},tick:{top:s,height:o},header:{height:h_height},footer:{height:q},
timeline_space:k-(q+h_height+o)};i.setDimensions(e);return e},initiateNavigation:function(){var a=this;b(".tg-single-timeline-header .tg-timeline-start").fadeIn();b(g).delegate(".tg-single-timeline-header h2",p,function(){var e=b(this).data("timeline_id");a.timelineModal(e);i.focusTimeline(e)})},displayZoomLevel:function(){var a=i.getZoomLevel();a>0&&u.display_zoom_level==true&&b(this._views.ZOOM_DISPLAY).text(a)},displayFocusDate:_.throttle(function(){var a=i.getFocusDate().format("d MMM yyyy",true);
b(this._views.FOCUS_DATE).find("span").text(a)},300),displayOutOfFrameEvents:_.throttle(function(){i.getPastEvents(true,true);i.getFutureEvents(true,true)},900),setPanButton:function(a,e){var f=this;b(a).bind("mousedown",function(){f.intervalMachine("pan",{type:"set",fn:f.pan,args:[e],intvl:33})}).bind("mouseup",function(){f.intervalMachine("pan",{type:"clear",fn:f.pan,callback:"resetTicksHandle"})}).bind("mouseout",function(){f.intervalMachine("pan",{type:"clear",fn:f.pan,callback:"resetTicksHandle"})})},
intervalMachine:function(a,e){var f=this;if(e.type==="clear"){clearInterval(l[a]);if(e.callback)f[e.callback]()}else l[a]=setInterval(function(){e.fn.apply(f,e.args)},e.intvl)},invSliderVal:function(a){return Math.abs(a-101)},pan:function(a){var e=a||20;a=b(m);e=a.position().left+e;a.css({left:e});i.setTicksOffset(e)},registerTitles:function(){var a,e,f,k,j,o,r,q,s,y,A=b(g).offset().left,C=b(this._views.TICKS).position().left;b(".tg-lane").css("left",-1*C);b(g+" .timeglider-event-spanning").each(function(){var D=
b(this);a=D.offset().left-A;j=D.find(".timeglider-event-title");$laneTitle=D.find(".timeglider-event-spanner span");e=j.outerWidth()||$laneTitle.outerWidth();f=D.find(".timeglider-event-spanner").outerWidth();if(f>e&&e)if(a<0)if(Math.abs(a)<f-e){j.css({marginLeft:-1*a+5});$laneTitle.css({marginLeft:-1*a+5})}else{j.css({marginLeft:f-e-5});$laneTitle.css({marginLeft:f-e-5})}else j.css({marginLeft:5})});b(g+" .tg-timeline-envelope").each(function(){o=b(this);r=o.offset().left-A;q=o.find(".titleBar");
k=q.data("lef");y=-1*(k+r);s=q.find(".timeline-title");if(y>0){var D=q.width()-s.width();y<D?s.css({marginLeft:y+5}):s.css({marginLeft:D-5})}else s.css({marginLeft:5})})},registerDragging:function(){var a=i.startSec,e=b(m).position().left,f=i.getZoomInfo().spp;a=new B(a-e*f);i.setFocusDate(a);this.displayFocusDate();this.displayOutOfFrameEvents()},getTimelinesTagsArray:function(){var a=[],e;_.each(i.timelineCollection.models,function(f){e=f.get("tags");_.each(e,function(k,j){a.push(j)})});return a},
setupFilter:function(){var a=this;b(a._views.FILTER_BT);var e=b.tmpl(a._templates.filter_modal,{}).appendTo(a._views.CONTAINER),f=false,k=false,j=a._views.FILTER_BOX,o=function(){i.setFilters({origin:"title_andor_desc",title:"",tags:"",description:""});b(j+" .timeglider-filter-search").val("");b(j+" .timeglider-filter-tags").val("");b("#filter-tags").val("").trigger("change")},r=function(){i.clearFilters({legend:false,custom:false})},q=a.getTimelinesTagsArray();if(q.length>0)b.fn.select2&&b("#filter-tags").select2({tags:q,
placeholder:"Click to select",allowClear:true});else b(".filter-tags").hide();e.position({my:"right+32 bottom-16",at:"right top",of:b(a._views.FILTER_BT)}).css("z-index",a.ztop++).hide();b(g).delegate(".timeglider-filter-box .tg-close-button","click",function(){o();e.fadeOut()});b(a._views.FILTER_BT).bind("click",function(){e.fadeIn();b(this);if(a.filterBoxActivated==false){a.filterBoxActivated=true;var s=b(j+" .timeglider-filter-apply"),y=b(j+" .timeglider-filter-clear"),A="",C="",D="",F="";b(j+
" .timeglider-filter-search").on("keydown",function(z){switch(z.which){case 0:case 9:case 13:s.trigger("click")}});s.bind("click",function(){r();C=b("#filter-tags").val();A=b(j+" .timeglider-filter-search").val();f=b(j+" input#filter_t").is(":checked");k=b(j+" input#filter_d").is(":checked");if(f&&A||k&&A||C){D=f?A:"";F=k?A:"";f&&k&&A?i.setFilters({origin:"clude",include:D,exclude:"",tags:C}):i.setFilters({origin:"title_andor_desc",title:D,description:F,tags:C})}else{r();o()}});y.bind("click",function(){r();
o()})}})},buildTimelineMenu:function(){var a=this,e,f=b(a._views.FOOTER).find(".tg-footer-buttons"),k={};k=b(a._views.TIMELINE_LIST_BT)[0]?b(a._views.TIMELINE_LIST_BT):b("<div class='timeglider-footer-button timeglider-list-bt'></div>").appendTo(f);b(a._views.TIMELINE_MENU)[0]&&b(a._views.TIMELINE_MENU).remove();e=b.tmpl(a._templates.timeline_list_modal,{}).appendTo(a._views.CONTAINER);var j=Backbone.View.extend({initialize:function(){this.model.bind("change",this.render,this)},tagName:"li",template:"${title}",
events:{click:"toggleTimeline"},toggleTimeline:function(){i.toggleTimeline(this.model.get("id"))},render:function(){var o=this.model.get("id"),r="";if(i.isActive(o))r="activeTimeline";b(this.el).html(b.tmpl(this.template,this.model.attributes)).data("timeline_id",o).addClass(r);return this}});b(a._views.TIMELINE_MENU_UL).html("");_.each(i.timelineCollection.models,function(o){b(a._views.TIMELINE_MENU_UL).append((new j({model:o})).render().el)});e.position({my:"right+50 bottom-12",at:"left top",of:k}).hide();
e.find(".tg-close-button").bind(p,function(){e.fadeOut()});k.bind(p,function(){e.fadeIn()})},getTimezonePulldown:function(a,e){var f="<select name='timezone' id='"+a+"'>",k=false,j="selected";b.map(B.timezones,function(o){if(e==o.offset&&k==false){j="selected";k=true}else j="";f+="<option value='"+o.offset+"' "+j+">"+o.name+"</option>"});f+="</select>";return f},buildSettingsMenu:function(){var a=b.tmpl(this._templates.settings_modal,{}).appendTo(this._views.CONTAINER),e=this.getTimezonePulldown("timeglider-settings-timezone",
i.timeOffset.string);a.find(".timeglider-settings-timezone").append('<span class="settings-label">timezone:</span> '+e+'<br><a class="btn" id="timeglider-settings-save">save</a>');a.position({my:"right+32 bottom-16",at:"right top",of:b(this._views.SETTINGS_BT)}).hide();b(g).delegate(".timeglider-settings-modal .tg-close-button","click",function(){a.fadeOut()});b(this._views.SETTINGS_BT).bind(p,function(){a.fadeIn()});a.find("#timeglider-settings-save").bind(p,function(){var f=b(g+" #timeglider-settings-timezone").val();
i.setTimeoffset(f);b(".timeglider-settings-modal").fadeOut()})},setupSingleTimeline:function(){var a=this,e={},f=i.singleTimelineID,k=i.timelineCollection.get(f);if(i.options.display_single_timeline_info!=false){e="<h2 data-timeline_id='"+f+"'>"+k.get("title")+"</h2>";inf=k.get("description")?"<li id='info' class='timeline-info-bt' data-timeline_id='"+f+"'>info</li>":"";leg=k.get("hasLegend")?"<li id='legend' class='tg-legend-bt' data-timeline_id='"+f+"'>legend</li>":"";tools="";tmpl="<div class='tg-widget-header tg-single-timeline-header'>"+
e+"<ul>"+inf+leg+"<li class='tg-timeline-start' data-timeline_id='"+f+"'>start</li></ul>"+tools+"</div>";$st=b(tmpl).appendTo(g);a.singleTitleHeight=$st.outerHeight()}else a.singleTitleHeight=0;a.dimensions=e=a.getWidgetDimensions();k.get("hasImageLane")&&a.buildImageLane();if(u.inverted==true){b(a._views.SLIDER_CONTAINER).css({bottom:"16px",top:"auto"});b(a._views.FOOTER).css({top:e.header.height+"px"});k.set({bottom:e.timeline_space-70,inverted:true});u.tick_top=e.container.height-(e.timeline_space+
a.tick_height)}else b(a._views.SLIDER_CONTAINER).css("top",a.singleTitleHeight+4);u.initial_timeline_modal!=false&&a.timelineModal(f);k.get("hasLegend")&&setTimeout(function(){a.legendModal(f)},500)},presentationModal:function(){if(!b(g).find("#presInfoModal")[0])if(i.presentation.description){var a=this.dimensions.container.height,e=new this.presInfoModal({model:i.presentation}),f=b(g).find(".tg-pres-header");b(e.render().el).appendTo(b(".timeglider-container")).position({my:"left top",at:"left+12 bottom+12",
of:f,collision:"flip fit"}).css({"z-index":this.ztop++,"max-height":a-64});b.jScrollPane&&b(".jscroll").jScrollPane()}},datePickerOpen:false,datepickerModal:function(){var a;if(!this.datepickerOpen){a=this;var e=a.dimensions.container.height,f=new this.datepicker({model:{}});b(f.render().el).appendTo(b(".timeglider-container")).position({my:"center bottom-39",at:"center bottom",of:b(".timeglider-container"),collision:"fit fit"}).css({"z-index":a.ztop++,"max-height":e-64});a.datepickerOpen=true}},
startPresentation:function(){var a=i.presentation;i.gotoDateZoom(a.focus_date.dateStr,a.initial_zoom)},setupPresentation:function(){var a=i.presentation,e=b("<div class='tg-widget-header tg-pres-header'>"+("<h2 id='pres_title' class='no-select' data-timeline_id='primary'>"+a.title+"</h2>")+"<ul>"+(a.description?"<li id='info' class='pres-info-bt'>info</li>":"")+(a.legend?"<li id='legend' data-timeline_id='pres' class='tg-legend-bt'>legend</li>":"")+"<li class='tg-pres-start'>start</li></ul></div>").appendTo(g);
this.getWidgetDimensions();this.singleTitleHeight=e.outerHeight();a.image_lane_height&&this.buildImageLane();b(this._views.SLIDER_CONTAINER).css("top",this.singleTitleHeight+4);this.startPresentation();a.open_modal&&a.description&&this.presentationModal()},buildImageLane:function(){var a=this;if(b(g).find(".tg-image-lane-pull").length==0){b("<div class='tg-image-lane-pull'><div title='This is the image lane!' class='tg-image-lane-bg'></div></div>").appendTo(g).draggable({axis:"y",containment:"parent",
drag:function(){var e=b(this),f=e.position().top;if(f>400){e.css("top",400);return false}else if(f<5){e.css("top",5);return false}},stop:function(){i.setImageLaneHeight(b(this).position().top-a.singleTitleHeight,true,false)}});a.setImageLaneHandle()}},setImageLaneHandle:function(){var a=parseInt(i.image_lane_height,10)+parseInt(this.singleTitleHeight,10);b(".tg-image-lane-pull").css("top",a+"px")},buildSlider:function(){var a=this,e=i.getZoomLevel();if(u.min_zoom==u.max_zoom)b(this._views.SLIDER_CONTAINER).css("display",
"none");else{u.display_zoom_level==true&&b("<div>").appendTo(this._views.SLIDER_CONTAINER).addClass("timeglider-zoomlevel-display").html("&nbsp;");a=this;e=a.invSliderVal(e);var f=i.max_zoom,k=i.min_zoom,j=(1+f-k)*3;b(this._views.SLIDER).css({height:j}).slider({steps:100,handle:b(".knob"),animate:300,orientation:"vertical",min:a.invSliderVal(f),max:a.invSliderVal(k),value:e,start:function(){a.sliderActive=true},stop:function(){a.sliderActive=false},change:function(){},slide:function(o,r){i.setZoomLevel(a.invSliderVal(r.value))}})}},
setupScroller:function(){if(u.event_overflow=="scroll"){b(".timeglider-slider-container").css("right","22px");b(g+" .tg-scroller-handle").draggable({containment:"parent",drag:function(){}})}},adjustScroller:function(a,e){if(u.event_overflow=="scroll"){var f=b(g+" .tg-scroller");b(g+" .tg-scroller-handle");(e+Math.abs(a))/this.dimensions.scroller_height>1||f.hide()}},getEventDateLine:function(a){var e="<span class='timeglider-dateline-startdate'>"+a.startdateObj.format("",true,i.timeOffset)+"</span>",
f="";if(a.span==true)f=" &ndash; <span class='timeglider-dateline-enddate'>"+a.enddateObj.format("",true,i.timeOffset)+"</span>";return e+f},eventHover:function(a,e){var f=true;if(typeof i.options.eventHover=="function")f=i.options.eventHover(a,e,this);if(f){f=b(".timeglider-event-hover-info");var k="",j="";a.append("<div class='tg-event-hoverline'></div>").addClass("tg-event-hovered");j=e.date_display=="no"?"":this.getEventDateLine(e);if((k=a.hasClass("tg-event-collapsed")||a.hasClass("tg-event-overflow")?
"<div>"+e.title+"</div>":"")||j)f.position({my:"left+1 top+4",at:"left bottom",of:a,collision:"flip flip"}).html(k+j)}},eventUnHover:function(a){a=a||"";if(typeof i.options.eventUnHover=="function")i.options.eventUnHover(a,this);else{b(".timeglider-event-hover-info").css("left","-1000px");b(".timeglider-timeline-event").removeClass("tg-event-hovered");a&&a.find(".tg-event-hoverline").remove()}},clearTicks:function(){this.tickNum=this.leftside=0;b(m).css("left",0);b(g+" .tg-timeline-envelope").remove();
b(g+" .timeglider-tick").remove()},castTicks:function(){if(i.viewMode=="timeline"){this.clearTicks();i.getZoomLevel();var a=i.getFocusDate(),e=i.getZoomInfo(),f=Math.ceil(this.dimensions.container.width/e.width)+4,k="l";if(typeof e.width=="number"){i.setTicksReady(false);this.addTick({type:"init",focus_date:a});for(a=1;a<=f;a+=1){this.addTick({type:k});k=k=="l"?"r":"l"}i.setTicksReady(true);this.displayFocusDate()}}else{this.clearTicks();this.freshTimelines()}},getTickTop:function(){var a=typeof i.options.tick_top;
return a=="number"?i.options.tick_top:a=="function"?i.options.tick_top(me.dimensions):parseInt(this.dimensions.tick.top)},addTick:function(a){var e=0,f=0,k=f=0,j=0,o=0,r=o="",q={};o={};k={};var s={};o={};q="";q=[];var y="";y=i.getZoomInfo().unit;s=i.getZoomInfo().width;j=i.getFocusDate();k=this.getTickTop();j=i.addToTicksArray({type:a.type,unit:y},j);if(y=="mo"){o=B.getMonthAdj(j,s);s=o.width;e=o.days}this.tickNum++;if(a.type=="init"){o=this.tickOffsetFromDate(i.getZoomInfo(),i.getFocusDate(),s);
f=Math.ceil(this.dimensions.container.centerx+o);b(m).data("init-left",f);this.leftside=f;this.rightside=f+s}else if(a.type=="l")this.leftside=f=Math.floor(this.leftside-s);else if(a.type=="r"){f=Math.floor(this.rightside);this.rightside+=s}i.getTickBySerial(j).width=s;i.getTickBySerial(j).left=f;o=this._views.PLACE+"_"+y+"_"+j+"-"+this.tickNum;o=b("<div class='timeglider-tick "+(j%2==0?"tg-even-tick":"tg-odd-tick")+"' id='"+o+"'><div class='tg-tick-body'><div class='tg-tick-leftline'></div><div class='timeglider-tick-label'></div><div class='tg-tick-label-bottom'></div></div>").appendTo(m);
o.css({width:s,left:f,top:k,zIndex:55});k=this.getTickMarksInfo({unit:y,width:s});k=e||k.tperu;f=s/k;if(f>8){a=10;for(a=e=0;a<k;a++){r="&nbsp;";if(f>16)if(y=="da")r=this.getHourLabelFromHour(a,f);else if(y=="mo")r=a+1;else if(y=="ye")r=f>30?"&nbsp;"+B.monthNamesAbbr[a+1]:"&nbsp;"+B.monthNamesLet[a+1];else if(y=="de"){if(f>54)r=j*10+a}else{if(y=="ce")if(f>38)r=(j*10+a)*10}else r="";q.push("<div class='timeglider-tick-sub-label "+y+"' style='left:"+e+"px;width:"+f+"px'>"+r+"</div>");e+=f}j<0&&q.reverse();
q=q.join("")}else q="";q&&o.append("<div class='tg-tick-sublabel-group' style='width:"+(s+10)+"px;'>"+q+"</div>");s={unit:y,width:s,serial:j};q=this.getDateLabelForTick(s);s.seconds=this.getTickSeconds[y](s.serial);o.find(".timeglider-tick-label").text(q);a=this.dimensions.container.height-(i.options.show_footer?46:14);o.find(".tg-tick-label-bottom").text(q).css("top",a);return s},resizeElements:function(){var a=this.dimensions.container.centerx,e=this.dimensions.container.height,f=this.dimensions.container.width,
k=this.dimensions.footer.height,j=this.dimensions.tick.height,o=b(this._views.CENTERLINE),r=b(this._views.DATE),q=a-r.width()/2;i.options.show_centerline===true?o.css({height:e,left:a}):o.css({display:"none"});a=e-(k+j);b(this._views.TICKS).css("height",a);a-=4;if(u.event_overflow=="scroll"){this.dimensions.scroller_height=a;b(this._views.CONTAINER).find(".tg-scroller").css({height:a+"px"})}else{this.dimensions.scroller_height=0;b(this._views.CONTAINER).find(".tg-scroller").remove()}e<500||f<500?
b(".timeglider-slider").css("display","none"):b(".timeglider-slider").css("display","block");r.css({left:q})},getTickSeconds:{da:function(a){a*=86400;return{start:a,end:a+86400}},mo:function(a){a*=2629800;return{start:a,end:a+2629800}},ye:function(a){a*=3154E4;return{start:a,end:a+3154E4}},de:function(a){a*=3154E5;return{start:a,end:a+3154E5}},ce:function(a){a*=3154E6;return{start:a,end:a+3154E6}},thou:function(a){a*=3154E6;return{start:a,end:a+3154E6}},tenthou:function(a){a*=3154E6;return{start:a,
end:a+3154E6}},hundredthou:function(a){a*=3154E6;return{start:a,end:a+3154E6}},mill:function(a){a*=3154E6;return{start:a,end:a+3154E6}},tenmill:function(a){a*=3154E6;return{start:a,end:a+3154E6}},hundredmill:function(a){a*=3154E7;return{start:a,end:a+3154E7}},bill:function(a){a*=3154E8;return{start:a,end:a+3154E8}}},getHourLabelFromHour:function(a,e){var f="",k=a,j="";j=0;if(e<16)return"";else{if(a>12)k=a-12;else if(a==0)k=12;if(e>30)f=a>11?" pm":" am";if(e>200){j=e/4-4;return"<div class='minutes' style='width:"+
j+"px'>"+k+":00 "+f+"</div><div class='minutes' style='width:"+j+"px'>"+k+":15 "+f+"</div><div class='minutes' style='width:"+j+"px'>"+k+":30 "+f+"</div><div class='minutes' style='width:"+j+"px'>"+k+":45 "+f+"</div>"}else return k+(e>60?":00":"")+f}},getTickMarksInfo:function(a){switch(a.unit){case "da":a=24;break;case "mo":a=30;break;case "ye":a=12;break;default:a=10}return{tperu:a}},getDateLabelForTick:function(a){var e=a.serial,f=a.width;switch(a.unit){case "bill":return e==0?"1":e>0?e+" billion":
e+" b.y. bce";case "hundredmill":return e==0?"1":e>0?e+"00 million":e+"00 m.y. bce";case "tenmill":return e==0?"1":e>0?e+"0 million":e+"0 m.y. bce";case "mill":return e==0?"1":e>0?e+" million":e+" m.y. bce";case "hundredthou":return e==0?"1":e>0?e+"00,000":e+"00,000 bce";case "tenthou":return e==0?"1":e>0?e+"0,000":e+"0,000 bce";case "thou":return e==0?"1("+e+")":e>0?e+"000":e+"000 bce";case "ce":return e==0?"1("+e+")":e>0?e+"00":e+"00 bce";case "de":return e>120?e*10+"s":e*10;case "ye":return e;
case "mo":a=B.getDateFromMonthNum(e);return f<120?B.monthNamesAbbr[a.mo]+" "+a.ye:B.monthNames[a.mo]+", "+a.ye;case "da":a=new B(B.getDateFromRD(e));return f<120?B.monthNamesAbbr[a.mo]+" "+a.da+", "+a.ye:B.monthNames[a.mo]+" "+a.da+", "+a.ye;default:return a.unit+":"+e+":"+f}},tickHangies:function(){var a=b(m).position().left,e=this.rightside+a-this.dimensions.container.width;if(this.leftside+a>-100){a=this.addTick({type:"l"});this.appendTimelines(a,"left")}else if(e<100){a=this.addTick({type:"r"});
this.appendTimelines(a,"right")}},tickOffsetFromDate:function(a,e,f){switch(a.unit){case "da":e=e.ho/24+e.mi/1440;f*=e;break;case "mo":a=B.getMonthDays(e.mo,e.ye);e=(e.da-1)/a+e.ho/(24*a)+e.mi/(1440*a);f*=e;break;case "ye":e=((e.mo-1)*30+e.da)/365;f*=e;break;case "de":e=e.ye%10/10+e.mo/120;f*=e;break;case "ce":e=e.ye%100/100+e.mo/1200;f*=e;break;case "thou":e=e.ye%1E3/1E3;f*=e;break;case "tenthou":e=e.ye%1E4/1E4;f*=e;break;case "hundredthou":e=e.ye%1E5/1E5;f*=e;break;case "mill":e=e.ye%1E6/1E6;f*=
e;break;case "tenmill":e=e.ye%1E7/1E7;f*=e;break;case "hundredmill":e=e.ye%1E8/1E8;f*=e;break;case "bill":e=e.ye%1E9/1E9;f*=e;break;default:f=0}return-1*f},resetTicksHandle:function(){b(this._views.HANDLE).offset({left:b(g).offset().left})},throttledResetTicksHandle:_.throttle(function(){this.resetTicksHandle()},500),easeOutTicks:function(){Math.abs(w)>5&&b(m).animate({left:"+="+3*w},1E3,"easeOutQuad",function(){debug.trace("stopping easing","note")})},getTimelineEventsByTick:function(a){var e=a.tick.unit,
f=a.tick.serial;a=i.eventCollection.getTimelineHash(a.timeline.timeline_id);return a[e][f]&&a[e][f].length>0?a[e][f]:[]},passesFilters:function(a,e){var f=true,k="";k="";var j=[],o;k="";o=[];o=[];if(e<a.low_threshold||e>a.high_threshold)return false;if(i.filters.imp_min&&i.filters.imp_min>1)if(a.importance<i.filters.imp_min)return false;if(i.filters.imp_max&&i.filters.imp_max<100)if(a.importance>i.filters.imp_max)return false;if(i.filters.custom&&typeof i.filters.custom=="function")f=i.filters.custom(a,
e);else{if(i.filters.include){f=false;j=i.filters.include.split(",");for(o=0;o<j.length;o++){k=RegExp(b.trim(j[o]),"i");if(a.title.match(k)||a.description.match(k))f=true}}else{if(i.filters.title){k=i.filters.title;o=k.split(",");f=false;for(j=0;j<o.length;j++){k=RegExp(b.trim(o[j]),"i");if(a.title.match(k))f=true}}if(i.filters.description){desr=i.filters.description;o=desr.split(",");f=false;for(j=0;j<o.length;j++){k=RegExp(b.trim(o[j]),"i");if(a.description.match(k))f=true}}}if(i.filters.exclude){j=
i.filters.exclude.split(",");for(o=0;o<j.length;o++){k=RegExp(b.trim(j[o]),"i");if(a.title.match(k)||a.description.match(k))f=false}}if(i.filters.tags.length>0)if(a.tags){f=false;ev_tags=a.tags.split(",");_.each(ev_tags,function(r){r=b.trim(r);if(_.indexOf(i.filters.tags,r)!==-1)f=true})}else f=false;if(i.filters.legend.length>0){k=a.icon;if(_.indexOf(i.filters.legend,k)==-1)f=false}}return f},freshTimelines:function(){var a=this,e,f,k,j=i.activeTimelines,o=i.ticksArray,r="",q,s,y;f="";var A=a.dimensions.container.centerx,
C=a.dimensions.container.width,D=i.getFocusDate().sec,F=i.getZoomInfo(),z=F.spp;F=F.unit;f=[];var G=[];C=Math.floor(z*(C/2));var N=D-C,O=D+C,K=0;k=0;var L,H=0;H=0;var I=i.options.minimum_timeline_bottom,P=a.dimensions.ticks.height;b.publish(h+".viewer.rendering");for(C=0;C<j.length;C++){G=[];k=i.timelineCollection.get(j[C]);e=k.attributes;e.visibleEvents=[];if(i.viewMode=="timeline"){L=e.display;tl_bottom=e.bottom?v(e.bottom):I;if(tl_bottom<I)tl_bottom=I;H=P-tl_bottom;I=i.options.minimum_timeline_bottom;
f=new t.TG_TimelineView({model:k});K=i.timeOffset.seconds/z;s=b(f.render().el).appendTo(m);var Q={};if(k.get("hasLanes")&&k.get("useLanes")){b(".tg-lane").remove();var R,T=32,M;_.each(k.get("lanes"),function(E){M=E.top||(T+=30);R=b("<div class='tg-lane'>"+E.title+"<div class='arrow-right'></div></div>");R.appendTo(s).draggable({axis:"y",stop:function(J){E.top=Math.abs(b(J.target).position().top);i.refresh()}}).css({top:-1*M,"border-left":"4px solid "+E.color}).find(".arrow-right").css({"border-left":"10px solid "+
E.color});E.top=Q[E.id]=Math.abs(M)})}q=s.find(".titleBar");q.outerHeight();a.room=H;s.draggable({axis:"y",handle:".titleBar",stop:function(){b(this).position();var E=P-v(b(this).css("top"))-1;if(E<I){b(this).css("bottom",I);E=I}var J=b(this).attr("id");i.timelineCollection.get(J).set({bottom:E});q.outerHeight();a.room=a.dimensions.ticks.height-E;i.refresh()}}).css({bottom:tl_bottom,left:K});if(typeof e.bounds!="undefined"){f=A+(e.bounds.first-D)/z;k=A+(e.bounds.last-D)/z}else{f=A;k=A+300}k=Math.floor(k-
f);if(k>1E6){K=k-1E6;k=1E6;if(f<-998E3)f+=K}q.css({top:void 0,left:f,width:k}).data({lef:f,wid:k});if(L=="expanded")e.borg=r=new timeglider.TG_Org;for(k=0;k<o.length;k++){f=o[k];f=this.getTimelineEventsByTick({tick:f,timeline:e});G=_.union(G,f)}e.visibleEvents=G;_.each(e.spans,function(E){if(_.indexOf(G,E.id)===-1)if(E.start<N&&E.end>O||E.end<O&&E.end>N){G.unshift(E.id);e.visibleEvents.push(E.id)}});f=this.compileTickEventsAsHtml(e,_.uniq(G),0,"sweep",F);H=u.event_overflow=="scroll"?1E4:e.inverted?
tl_bottom-16:e.hasImageLane||t.mode=="authoring"?H-i.image_lane_height-a.singleTitleHeight:H-a.singleTitleHeight;k=e.initial_zoom==i.getZoomLevel();if(L=="expanded"){f=r.getHTML({tickScope:"sweep",ceiling:H,onIZoom:k,inverted:e.inverted,laneTops:Q});e.borg=r.getBorg()}if(f!="undefined"){s.append(f.html);a.adjustScroller(f.high,f.low)}setTimeout(function(){a.registerEventImages(s)},100)}else if(i.viewMode=="list"){b("#tg-list-wrapper").remove();b("<div id='tg-list-wrapper'><div id='tg-list' class='tg-list-events'><ul id='list-events-ul' class='list-ul'></ul></div></div>").prependTo(g);
r=i.eventCollection.getTimelineHash(k.get("id"));var S=[];_.each(r.all,function(E){y=i.eventCollection.get(E).attributes;a.passesFilters(y,0)===true&&S.push(y)});r=new timeglider.TG_OrgList(S,i);f=r.getHTML();f!="undefined"&&b(".tg-list-events ul").append(f.html);t.listIScroll=new iScroll("tg-list-wrapper");setTimeout(function(){b(".tg-legend .tg-legend-close").trigger(p)},300);b(".tg-list-li").bind("click",function(){if(t.listIScroll.distance>20||t.listIScroll.moved)return false;var E=b(this),J=
E.attr("id");a.eventModal(J,E)})}}a.registerTitles();setTimeout(function(){a.applyFilterActions();i.setInitialScope()},300);b.publish(h+".viewer.rendered")},appendTimelines:function(a,e){var f=i.activeTimelines,k=[],j,o;j="";var r=0,q=this;b.publish(h+".viewer.rendering");for(var s=0;s<f.length;s++){j=i.timelineCollection.get(f[s]);o=j.attributes;k=this.getTimelineEventsByTick({tick:a,timeline:o});o.visibleEvents=_.union(o.visibleEvents,k);tl_top=o.top?v(o.top):q.initTimelineVOffset;e=="left"&&_.each(o.spans,
function(C){if(C.end<a.seconds.end&&C.end>a.seconds.start)if(_.indexOf(o.visibleEvents,C.id)===-1){k.unshift(C.id);o.visibleEvents.push(C.id)}});var y={};j.get("hasLanes")&&j.get("useLanes")&&_.each(j.get("lanes"),function(C){y[C.id]=Math.abs(C.top)});j=this.compileTickEventsAsHtml(o,k,a.serial,"append",a.unit);r=u.event_overflow=="scroll"?1E4:o.hasImageLane?tl_top-i.image_lane_height-q.singleTitleHeight:tl_top;var A=o.initial_zoom==i.getZoomLevel();if(o.display=="expanded")j=o.borg.getHTML({tickScope:a.serial,
ceiling:r,onIZoom:A,inverted:o.inverted,laneTops:y});b(g+" .tg-timeline-envelope#"+o.id).append(j.html);q.adjustScroller(j.low,j.high);this.registerEventImages(void 0)}setTimeout(function(){q.applyFilterActions()},500);b.publish(h+".viewer.rendered")},compileTickEventsAsHtml:function(a,e,f,k,j){var o=0,r=this.dimensions.container.centerx,q=a.display,s="",y=i.startSec,A=i.getZoomInfo(),C=A.spp;A=A.level;var D=o=0,F=a.borg||"",z={};D=o=0;var G="sweep";F&&a.borg.clearFresh();if(k=="append")G=f;for(f=
0;f<e.length;f++){z=i.eventCollection.get(e[f]).attributes;if(this.passesFilters(z,A)===true){o=r+(z.startdateObj.sec*(!(j=="da"||j=="mo"||j=="ye"||j=="de"||j=="ce"||j=="thou")?0.99795:1)-y)/C;if(q=="expanded"){k=a.size_importance===true||a.size_importance===1?t.scaleToImportance(z.importance,A):1;z.width=z.titleWidth*k+16;z.fontsize=i.base_font_size*k;z.left=o;z.spanwidth=0;if(z.span==true){z.spanwidth=(z.enddateObj.sec-z.startdateObj.sec)/C;if(z.spanwidth>z.width)z.width=z.spanwidth+16}o=Math.ceil(z.fontsize);
z.height=z.fixed_height||o+4;z.top=0-z.height;z.bottom=0;if(z.image&&z.image.display_class=="inline"){k=(z.image.scale||100)/100;o=k*z.image.height+2;D=k*z.image.width+2;z.shape={img_ht:o,img_wi:D,title:"shape",top:z.top-(o+8),bottom:z.bottom,left:z.left,right:z.left+(D+8)}}else z.shape="";F.addBlock(z,G)}else if(q=="collapsed"){D=a.inverted?4:-20;colIcon=z.icon?t.icon_folder+z.icon:t.icon_folder+"shapes/circle_white.png";s+="<div id='"+z.id+"' class='timeglider-timeline-event tg-event-collapsed' style='top:"+
D+"px;left:"+o+"px'><img src='"+colIcon+"'></div>"}}}return q=="collapsed"?{html:s}:""},registerEventImages:function(){var a=i.image_lane_height,e=this.singleTitleHeight;if(a>400)a=400;b(g+" .timeglider-event-image-lane").each(function(){var f=b(this),k=a-2,j=b(this).find("img"),o=parseInt(f.data("max_height"),10)||400;if(o<k)k=o;if(k>10){f.css({display:"block"}).position({my:"center top+"+(e+4),at:"center top",of:b(g)}).css({left:0});j.css("height",k-4)}else f.css({display:"none"})})},applyFilterActions:function(){var a=
i.filterActions,e=i.eventCollection.models,f;_.isEmpty(a)||_.each(a,function(k){_.each(e,function(j){if(k.filter(j)){f=j.get("id");k.fn(b(".timeglider-timeline-event#"+f))}})})},expandCollapseTimeline:function(a){a=i.timelineCollection.get(a).attributes;a.display=a.display=="expanded"?"collapsed":"expanded";i.refresh()},invertTimeline:function(a){a=i.timelineCollection.get(a).attributes;a.inverted=a.inverted==false?true:false;i.refresh()},timelineModal:function(a){b(".tg-timeline-modal").remove();
var e=i.timelineCollection.get(a);if(e.get("description")){a=this.dimensions.container.height;e=new this.timelineInfoModal({model:e});b(".tg-widget-header").outerHeight();b(".timeglider-container").position();a=b(e.render().el).appendTo("body").position({my:"left+16 top+39",at:"left top",of:b(".timeglider-container"),collision:"none none"}).css({"z-index":this.ztop++,"max-height":a-64});i.singleTimelineID&&a.find("h4").hide();b.fn.jScrollPane&&b(".jscroll").jScrollPane()}},createEventLinksMenu:function(a){if(!a)return"";
var e="",f=0,k="",j="";if(typeof a=="string")e="<li><a href='"+a+"' target='_blank'>link</a></li>";else if(typeof a=="object")for(f=0;f<a.length;f++){k=a[f].url;j=a[f].label;e+="<li><a href='"+k+"' target='_blank'>"+j+"</a></li>"}return e},eventModal:function(a,e){b.publish(h+".viewer.eventModal");b(g+" #"+a+"_modal").remove();var f=this,k=false,j=false,o="";o={};var r;o=0;var q=i.eventCollection.get(a).attributes;r=q.modal_type||u.event_modal.type;var s=q.image&&q.image.src?"<img src='"+q.image.src+
"'>":"",y=this.createEventLinksMenu(q.link);s={id:q.id,title:q.title,description:q.description,link:q.link,dateline:f.getEventDateLine(q),links:y,image:s};if(q.video){s.video=q.video;r="full";j=true;s.video=q.video}else if(q.map&&q.map.latlong){k=true;r="full"}else if(q.description.length>1200||f.dimensions.container.width<500)r="full";switch(r){case "full":r=b.tmpl(f._templates.event_modal_full,s);s=32;r.appendTo(g).position({my:"left top",at:"left top",of:g,collision:"none none"});s=f.dimensions.container.height;
var A=f.dimensions.container.width;y=r.find(".tg-full_modal_panel");r=A-64;s-=64;o=0;y.css({width:r,height:s,top:"32px",left:"32px"});y=b(".tg-full_modal-body");A=s-120;if(k==true){$map=b("<div id='map_modal_map' class='tg-modal_map'></div>").prependTo(y);o=q.map.zoom||12;k=String(q.map.latlong).split(",");k=new google.maps.LatLng(parseFloat(k[0]),parseFloat(k[1]));o={zoom:o,center:k,mapTypeId:google.maps.MapTypeId.ROADMAP};o=new google.maps.Map(b("#map_modal_map")[0],o);if(q.map.markers)for(k=0;k<
q.map.markers.length;k++){j=q.map.markers[k];new google.maps.MarkerImage(j.image,new google.maps.Size(24,32),new google.maps.Point(0,0),new google.maps.Point(0,32));var C=j.latlong.split(",");C=new google.maps.LatLng(C[0],C[1]);j=new google.maps.Marker({position:C,map:o,icon:j.icon,title:j.title,zIndex:j.zIndex})}}else if(j==true){$vid=b("<div class='tg-modal-video'><iframe frameborder='0' src='"+q.video+"'></iframe></div>").appendTo(".tg-full_modal-vidimg");if(s>450)$vid.find("iframe").css("height",
$vid.width()*0.66);else{k=s-80;j=k*1.5;$vid.find("iframe").css({"float":"left",height:k,width:j})}}if(q.image){k=b(".tg-full_modal-body img");s-=110;if(q.image.height>s)k.css("height",s);else if(q.image.width<r/3){o=q.image.width;k.css("width",o)}}y.height()>A-16&&y.css({height:A-16,"overflow-y":"scroll"});break;case "link-iframe":r=b.tmpl(f._templates.event_modal_iframe,s);r.appendTo(m).css("z-index",f.ztop++).position({my:"center top+32",at:"center top",of:b(g),collision:"flip fit"}).hover(function(){b(this).css("z-index",
f.ztop++)});break;case "custom":break;default:s.extra_class=s.image?"has-image":"no-image";r=b.tmpl(f._templates.event_modal_small,s).appendTo(f._views.TICKS);s=8;q="";o=e.position().top;C=e.offset();y=f.dimensions.container.width;var D=f.dimensions.container.offset;A=r.outerHeight();k=r.outerWidth();j=e.closest(".tg-timeline-envelope").position().top+o-28;o=Math.abs(o);var F="",z="";C=C.left-D.left;D=f.dimensions.container.width-(k+s);if(C<s)q="+"+String(s+C*-1);else if(C>D)q="-"+(s*4+(k-(y-C)));
if(j>A+12){F="left"+q+" bottom-12";z="left top"}else if(o>A){F="left"+q+" top+8";z="left bottom"}else{F="center"+q+" center";z="center center"}r.css({"z-index":f.ztop++}).position({my:F,at:z,of:e,collision:"flip flip"})}b.fn.jScrollPane&&b(".jscroll").jScrollPane()},legendModal:function(a){var e=[];if(a=="pres"||timeglider.mode=="presentation"){if(typeof i.presentation.legend=="object")e=i.presentation.legend}else e=i.timelineCollection.get(a).attributes.legend;var f="",k="";k=u.legend.type==="checkboxes"?
"tg-legend-item tg-legend-icon-selected":"tg-legend-item";_.each(e,function(j){f+="<li class='"+k+"'><img class='tg-legend-icon' src='"+u.icon_folder+j.icon+"'><span class='legend-info'>"+j.title+"</span></li>"});a={id:a,legend_list:f};b(g+" .tg-legend").remove();b.tmpl(this._templates.legend_modal,a).appendTo(g).css("z-index",this.ztop++).toggleClass("tg-display-none").position({my:"right-64 top+38",at:"right top",of:b(g),collision:"none"});b(g).delegate(".tg-legend-item","mouseup",function(){var j=
b(this),o=j.children("img").attr("src");j.toggleClass("tg-legend-icon-selected");i.setFilters({origin:"legend",icon:o})});u.legend.type==="checkboxes"&&setTimeout(function(){b(".tg-legend-all").trigger("click")},200)},parseHTMLTable:function(a){var e={},f=+new Date,k=[];b("#"+a).find("tr").each(function(j){var o=b(this).children(),r;if(j===0)k=o.map(function(){return b(this).attr("class").replace(/^.*?\btg-(\S+)\b.*?$/,"$1")}).get();else{r={};o.each(function(q){r[k[q]]=b(this).text()});e["prefix"+
f++]=r}});return e}};t.TG_TimelineView=Backbone.View.extend({initialize:function(a){var e=this;this.mediator=a.model.get("mediator");this.model.bind("change:title",function(){b(e.el).find(".timeline-title-span").text(e.model.get("title"))});this.titleBar=this.mediator.timelineCollection.length>1||t.mode=="authoring"?"fullBar":"hiddenBar";this.model.bind("destroy",this.remove,this)},tagName:"div",events:{"click .timeline-title-span":"titleClick"},className:"tg-timeline-envelope clearfix",getTemplate:function(){var a=
"",e="";a="";a=this.model.get("inverted")?" timeline-inverted":"";debug.log("titlebar:",this.titleBar);if(this.titleBar=="fullBar"){a="<div class='titleBar'><div class='timeline-title"+a+"'><span class='timeline-title-span'>";e="<div class='tg-env-buttons'>";if(this.model.get("description"))e+="<div class='tg-env-button tg-env-info timeline-info-bt' data-timeline_id='${id}'></div>";if(this.model.get("hasLegend"))e+="<div class='tg-env-button tg-env-legend tg-legend-bt' data-timeline_id='${id}'></div>";
e+="<div class='tg-env-button tg-env-invert tg-invert-bt' data-timeline_id='${id}'></div>";e+="<div class='tg-env-button tg-env-expcol tg-expcol-bt' data-timeline_id='${id}'></div>";e+="</div>";a+=e+"${title}</span></div></div>"}else a=this.titleBar=="imageBar"?"<div class='titleBar imageBar'></div>":"<div class='titleBar tg-display-none'></div>";return a},render:function(){this.model.get("id");this.model.get("title");var a=this.getTemplate(),e=this.model.get("inverted")?"inverted":"straight-up";
b(this.el).html(b.tmpl(a,this.model.attributes)).attr("id",this.model.get("id")).addClass(e);return this},setText:function(){},titleClick:function(){i.timelineTitleClick(this.model.get("id"))},remove:function(){b(this.el).remove()}});t.zoomTree=[{},{unit:"da",width:35E3,level:1,label:"30 minutes"},{unit:"da",width:17600,level:2,label:"1 hour"},{unit:"da",width:8800,level:3,label:"2 hours"},{unit:"da",width:4400,level:4,label:"5 hours"},{unit:"da",width:2200,level:5,label:"10 hours"},{unit:"da",width:1100,
level:6,label:"1 DAY"},{unit:"da",width:550,level:7,label:"40 hours"},{unit:"da",width:432,level:8,label:"2 days"},{unit:"da",width:343,level:9,label:"2.5 days"},{unit:"da",width:272,level:10,label:"3 days"},{unit:"da",width:216,level:11,label:"4 days"},{unit:"da",width:171,level:12,label:"5 days"},{unit:"da",width:136,level:13,label:"1 WEEK"},{unit:"da",width:108,level:14,label:"8 days"},{unit:"mo",width:2509,level:15,label:"10 days"},{unit:"mo",width:1945,level:16,label:"2 WEEKS"},{unit:"mo",width:1508,
level:17,label:"18 days"},{unit:"mo",width:1169,level:18,label:"3 weeks"},{unit:"mo",width:913,level:19,label:"1 MONTH"},{unit:"mo",width:719,level:20,label:"5 weeks"},{unit:"mo",width:566,level:21,label:"6 weeks"},{unit:"mo",width:453,level:22,label:"2 MONTHS"},{unit:"mo",width:362,level:23,label:"10 weeks"},{unit:"mo",width:290,level:24,label:"3 MONTHS"},{unit:"mo",width:232,level:25,label:"4 months"},{unit:"mo",width:186,level:26,label:"5 months"},{unit:"mo",width:148,level:27,label:"6 MONTHS"},
{unit:"mo",width:119,level:28,label:"7 months"},{unit:"mo",width:95,level:29,label:"9 months"},{unit:"mo",width:76,level:30,label:"1 YEAR"},{unit:"ye",width:723,level:31,label:"15 months"},{unit:"ye",width:573,level:32,label:"18 months"},{unit:"ye",width:455,level:33,label:"2 YEARS"},{unit:"ye",width:361,level:34,label:"2.5 years"},{unit:"ye",width:286,level:35,label:"3 years"},{unit:"ye",width:227,level:36,label:"4 years"},{unit:"ye",width:179,level:37,label:"5 years"},{unit:"ye",width:142,level:38,
label:"6 years"},{unit:"ye",width:113,level:39,label:"8 years"},{unit:"ye",width:89,level:40,label:"10 years"},{unit:"de",width:705,level:41,label:"13 years"},{unit:"de",width:559,level:42,label:"16 years"},{unit:"de",width:443,level:43,label:"20 years"},{unit:"de",width:302,level:44,label:"25 years"},{unit:"de",width:240,level:45,label:"30 years"},{unit:"de",width:190,level:46,label:"40 years"},{unit:"de",width:150,level:47,label:"50 years"},{unit:"de",width:120,level:48,label:"65 years"},{unit:"de",
width:95,level:49,label:"80 years"},{unit:"de",width:76,level:50,label:"100 YEARS"},{unit:"ce",width:600,level:51,label:"130 years"},{unit:"ce",width:480,level:52,label:"160 years"},{unit:"ce",width:381,level:53,label:"200 YEARS"},{unit:"ce",width:302,level:54,label:"250 years"},{unit:"ce",width:240,level:55,label:"300 years"},{unit:"ce",width:190,level:56,label:"400 years"},{unit:"ce",width:150,level:57,label:"500 YEARS"},{unit:"ce",width:120,level:58,label:"600 years"},{unit:"ce",width:95,level:59,
label:"1000 YEARS"},{unit:"ce",width:76,level:60,label:"1100 years"},{unit:"thou",width:603,level:61,label:"1500 years"},{unit:"thou",width:478,level:62,label:"2000 years"},{unit:"thou",width:379,level:63,label:"2500 years"},{unit:"thou",width:301,level:64,label:"3000 years"},{unit:"thou",width:239,level:65,label:"4000 years"},{unit:"thou",width:190,level:66,label:"5000 YEARS"},{unit:"thou",width:150,level:67,label:"6000 years"},{unit:"thou",width:120,level:68,label:"7500 years"},{unit:"thou",width:95,
level:69,label:"10,000 YEARS"},{unit:"thou",width:76,level:70,label:"12,000 years"},{unit:"tenthou",width:603,level:71,label:"15,000 years"},{unit:"tenthou",width:358,level:72,label:"25,000 years"},{unit:"tenthou",width:213,level:73,label:"40,000 years"},{unit:"tenthou",width:126,level:74,label:"70,000 years"},{unit:"tenthou",width:76,level:75,label:"100,000 YEARS"},{unit:"hundredthou",width:603,level:76,label:"150,000 years"},{unit:"hundredthou",width:358,level:77,label:"250,000 years"},{unit:"hundredthou",
width:213,level:78,label:"400,000 years"},{unit:"hundredthou",width:126,level:79,label:"700,000 years"},{unit:"hundredthou",width:76,level:80,label:"1 million years"},{unit:"mill",width:603,level:81,label:"1.5 million years"},{unit:"mill",width:358,level:82,label:"3 million years"},{unit:"mill",width:213,level:83,label:"4 million years"},{unit:"mill",width:126,level:84,label:"6 million years"},{unit:"mill",width:76,level:85,label:"10 million years"},{unit:"tenmill",width:603,level:86,label:"15 million years"},
{unit:"tenmill",width:358,level:87,label:"25 million years"},{unit:"tenmill",width:213,level:88,label:"40 million years"},{unit:"tenmill",width:126,level:89,label:"70 million years"},{unit:"tenmill",width:76,level:90,label:"100 million years"},{unit:"hundredmill",width:603,level:91,label:"120 million years"},{unit:"hundredmill",width:358,level:92,label:"200 million years"},{unit:"hundredmill",width:213,level:93,label:"300 million years"},{unit:"hundredmill",width:126,level:94,label:"500 million years"},
{unit:"hundredmill",width:76,level:95,label:"1 billion years"},{unit:"bill",width:603,level:96,label:"15 million years"},{unit:"bill",width:358,level:97,label:"30 million years"},{unit:"bill",width:213,level:98,label:"50 million years"},{unit:"bill",width:126,level:99,label:"80 million years"},{unit:"bill",width:76,level:100,label:"100 billion years"}];t.calculateSecPerPx=function(a){for(var e=1;e<a.length;e++){var f=a[e],k=0;switch(f.unit){case "da":k=86400;break;case "mo":k=2419200;break;case "ye":k=
31536E3;break;case "de":k=31536E4;break;case "ce":k=31536E5;break;case "thou":k=31536E6;break;case "tenthou":k=31536E7;break;case "hundredthou":k=31536E8;break;case "mill":k=31536E9;break;case "tenmill":k=31536E10;break;case "hundredmill":k=31536E11;break;case "bill":k=31536E12}f.spp=Math.round(k/parseInt(f.width))}}(t.zoomTree);t.getStringWidth=function(a){var e=b("#timeglider-measure-span");e.css("font-size",i.base_font_size);return a?e.html(a).width()+i.base_font_size:false};t.scaleToImportance=
function(a,e){return((a-e)*4.5+100)/100};String.prototype.removeWhitespace=function(){return this.replace(RegExp("\\n","g"),"")};if(debug)debug.trace=function(a,e){b("#"+e).text(a)};t.googleMapsInit=function(){};t.googleMapsLoaded=false;t.googleMapsLoad=function(){if(t.googleMapsLoaded==false){var a=document.createElement("script");a.type="text/javascript";a.src="http://maps.googleapis.com/maps/api/js?sensor=false&callback=timeglider.googleMapsInit";document.body.appendChild(a);t.googleMapsLoaded=
true}}})(timeglider);(function(t){var B={},x=t.TG_Date,i={},u=jQuery,w={},n="";t.TG_Mediator=function(d,h){this.options=i=d;w=h;n=d.base_namespace+"#"+w.attr("id");this.viewMode="timeline";this._focusDate={};this._zoomInfo={};this._zoomLevel=0;this.ticksReady=false;this.ticksArray=[];this.startSec=0;this.activeTimelines=[];this.max_zoom=i.max_zoom;this.min_zoom=i.min_zoom;this.icon_folder=t.icon_folder=i.icon_folder||"js/timeglider/icons/";this.timeOffset=x.getTimeOffset(i.timezone);this.base_font_size=14;this.fixed_zoom=
this.max_zoom==this.min_zoom?true:false;this.gesturing=false;this.gestureStartScale=this.gestureStartZoom=0;this.filters={include:"",exclude:"",legend:[],tags:[]};this.filterActions={};this.loadedSources=[];this.timelineCollection=new Backbone.Collection;this.eventCollection=new t.TG_EventCollection;this.imagesToSize=this.imagesSized=0;this.timelineDataLoaded=false;this.image_lane_height=0;this.initial_timelines=[];this.initial_timeline_id=i.initial_timeline_id||"";this.sole_timeline_id="";this.dimensions=
{};this.focusedEvent="";this.scopeChanges=this.singleTimelineID=0;this.freshData=true;this.boundsCache={};this.initialScope={};this.scopeCache={};this.drillMap=[];if(i.max_zoom===i.min_zoom)this.fixed_zoom=i.min_zoom;if(i.main_map){this.main_map=i.main_map;timeglider.mapping.setMap(this.main_map,this)}B=this};t.TG_Mediator.prototype={emptyData:function(){this.eventCollection.reset();this.timelineCollection.reset();this.eventCollection=new t.TG_EventCollection;this.timelineCollection=new Backbone.Collection;
this.activeTimelines=[];this.freshData=true},focusToEvent:function(d,h){this.focusedEvent=d;this.gotoDateZoom(d.startdateObj.dateStr);u.publish(n+".mediator.focusToEvent");typeof h=="function"&&h(d)},filterBy:function(d,h){var b={origin:d};b[d]=h;this.setFilters(b)},setImageLaneHeight:function(d,h,b){this.image_lane_height=d;b&&u.publish(n+".mediator.imageLaneHeightSetUi");h&&this.refresh()},setInitialScope:function(){this.initialScope=this.scopeCache;u.publish(n+".mediator.initialScope")},getInitialScope:function(){return this.initialScope},
isActive:function(d){return _.contains(this.activeTimelines,d)},gotoDateZoom:function(d,h){var b=false;this.setFocusDate(new x(d));if(h)b=this.setZoomLevel(h);if(!h||b==false)this.refresh();u.publish(n+".mediator.scopeChange")},zoom:function(d){this.setZoomLevel(this.getZoomLevel()+parseInt(d))},focusTimeline:function(d){var h=this.timelineCollection.get(d);d=h.get("focus_date");h=h.get("initial_zoom");this.gotoDateZoom(d,h)},loadPresentation:function(d){var h=this,b=d.timelines,l="",c=[],g=0,m=0,
p="expanded",v={};if(d.timelines.length>0){_.each(b,function(a){if(a.open==1){l=a.timeline_id;c.push(l);m=a.bottom||30;p=a.display||"expanded";g=a.inverted||0;v=h.timelineCollection.get(l);v.set({inverted:g,display:p,bottom:m})}});h.setFocusDate(new t.TG_Date(d.focus_date));h.activeTimelines=c;h.setZoomLevel(d.initial_zoom);h.setImageLaneHeight(d.image_lane_height||0,false,true);h.refresh()}else{alert("There are no timelines in this presentation...");return false}},reloadTimeline:function(d){var h=
d.id,b=d.source;d=typeof d.call_this=="function"?d.call_this:"";var l=this.timelineCollection.get(h),c=this.eventCollection,g=this.eventCollection.getTimelineHash(h).all;_.each(g,function(m){c.remove(m)});this.timelineCollection.remove(l);this.eventCollection.setTimelineHash(h,{});this.loadTimelineData(b,{fn:d},true);this.freshData=true},drilldown:function(d){this.drillMap.push({trigger:d,active:this.activeTimelines,focus:this.getFocusDate()});this.loadTimelineData(d.drilldown.data_source,{fn:function(){},
toggle:true,load_as_only_timeline:true})},drillup:function(){},getScope:function(){var d=this.getZoomInfo(),h=this.getFocusDate(),b=this.getActiveTimelinesBounds();h=Math.round(h.sec);var l=t.TG_Date.TGSecToUnixSec(h),c=this.dimensions.container.width,g=c/2;d=Math.round(d.spp);return this.scopeCache=b={spp:d,width:c,focusDateSec:h,timelines:this.activeTimelines,timelineBounds:b,container:w,left_sec:h-g*d,right_sec:h+g*d,leftMS:(l-g*d)*1E3,rightMS:(l+g*d)*1E3,focusMS:l*1E3}},fitToContainer:function(){var d=
this.getActiveTimelinesBounds(),h=d.last-d.first;d=(d.first+d.last)/2;var b=this.dimensions.container.width,l=_.find(t.zoomTree,function(c){return h/c.spp<b});this.gotoDateZoom(d,l.level)},resize:function(){u.publish(n+".mediator.resize")},addFilterAction:function(d,h,b){this.filterActions[d]={filter:h,fn:b};this.refresh()},removeFilterAction:function(d){delete this.filterActions[d];this.refresh()},getEventByID:function(d,h){var b=this.eventCollection.get(d).attributes;return h&&b.hasOwnProperty(h)?
b[h]:b},getPastEvents:function(d,h){var b=this,l=this.getScope(),c=false;return l.timelineBounds.first<l.focusDateSec?_.filter(this.eventCollection.models,function(g){if(h){if(g.get("startdateObj").sec<l.left_sec)c=true}else c=true;var m=d?b.isEventVisible(g):true,p=_.intersection(b.activeTimelines,g.get("timelines"));return c&&p.length>0&&m&&g.get("startdateObj").sec<l.focusDateSec}):false},gotoPreviousEvent:function(){if(this.activeTimelines.length==0){alert("No timelines are loaded.");return false}var d=
this.getPastEvents(true,false);if(d.length>0)this.focusToEvent(_.last(d).attributes,function(h){u(".timeglider-timeline-event").removeClass("tg-event-selected");u(".timeglider-timeline-event#"+h.id).addClass("tg-event-selected")});else{alert("There are no events prior to this point");return false}},getFutureEvents:function(d,h){var b=this,l=this.getScope(),c=false;return l.timelineBounds.last>l.focusDateSec?_.filter(this.eventCollection.models,function(g){if(h){if(g.get("startdateObj").sec>l.right_sec)c=
true}else c=true;var m=d?b.isEventVisible(g):true,p=_.intersection(b.activeTimelines,g.get("timelines"));return c&&p.length>0&&m&&g.get("startdateObj").sec>l.focusDateSec}):false},gotoNextEvent:function(){if(this.activeTimelines.length==0){alert("No timelines are loaded.");return false}var d=this.getFutureEvents(true,false);if(d.length>0)this.focusToEvent(_.first(d).attributes,function(h){u(".timeglider-timeline-event").removeClass("tg-event-selected");u(".timeglider-timeline-event#"+h.id).addClass("tg-event-selected")});
else{alert("There are no events farther ahead of this point.");return false}},isEventVisible:function(d){var h=this._zoomLevel;return h<=d.get("high_threshold")&&h>=d.get("low_threshold")?true:false},adjustNowEvents:function(){var d=false,h="",b="";_.each(this.eventCollection.models,function(l){if(l.get("keepCurrent")){h=l.get("keepCurrent");b=l.get("date_display");if(h==1||h==3)l.set({startdateObj:new x("today",b)});if(h==2||h==3)l.set({enddateObj:new x("today",b)});l.reIndex();d=true}});this.freshData=
true;d&&this.refresh()},addEvent:function(d,h){h=h||false;d.startdateObj=new t.TG_Date(d.startdate);d.enddateObj=new t.TG_Date(d.enddate||d.startdate);d.mediator=this;d.cache={timelines:d.timelines,startdateObj:d.startdateObj,enddateObj:d.enddateObj,span:true};var b=new t.TG_Event(d);this.eventCollection.add(b);b.reIndex();h&&this.refresh();u.publish(n+".mediator.addEvent");this.freshData=true;return b},updateEvent:function(d){if(!d.id){alert("error: you need a valid id set on the object in updateEvent()");
return false}var h=this.eventCollection.get(d.id);h.set(d);if(d.startdateObject||d.enddateObject)h.reIndex();this.freshData=true;this.refresh();u.publish(n+".mediator.updateEvent");return h},getActiveTimelinesBounds:function(){if(this.freshData==true){for(var d=this.activeTimelines,h={},b=99999999999,l=0,c=0;c<d.length;c++){h=this.timelineCollection.get(d[c]);b=h.get("bounds").first<b?h.get("bounds").first:b;l=h.get("bounds").last>l?h.get("bounds").last:l}this.boundsCache=d={first:b,last:l};this.freshData=
false;return d}else return this.boundsCache},removeFromActive:function(d){d=_.indexOf(this.activeTimelines,d);if(d!=-1){this.activeTimelines.splice(d,1);return true}else return false},loadTimelineData:function(d,h,b){b=b||false;var l=this;if(d){if(_.indexOf(l.loadedSources,d)==-1||b==true){if(typeof d==="object")l.parseTimelineData(d,h);else if(d.substr(0,1)=="#"){b=[l.getTableTimelineData(d)];l.parseTimelineData(b)}else u.ajax({url:d,type:"GET",cache:false,dataType:"json",error:function(c,g,m){debug.log("loadTimelineData json error:",
JSON.stringify(c),JSON.stringify(g),m)},success:function(c){if(c.error){c.password_required==1?alert("This presentation requires a password. Here at Timeglider, we're rebuilding our presentation system. Come back soon!"):alert(c.error);return false}else l.parseTimelineData(c,h)}});l.loadedSources.push(d)}}else{this.timelineDataLoaded=true;this.setZoomLevel(Math.floor((this.max_zoom+this.min_zoom)/2));this.tryLoading()}this.freshData=true},mapMarkerClick:function(d){this.focusToEvent(d)},getTimelineCollection:function(){return this.timelineCollection},
timelineTitleClick:function(d){u.publish(n+".mediator.timelineTitleClick",{timeline_id:d})},getTableTimelineData:function(d){var h={},b=0,l=[],c,g,m="",p=u(d);h.id=d.substr(1);h.title=p.attr("title")||"untitled";h.description=p.attr("description")||"";h.focus_date=p.attr("focus_date")||x.getToday();h.initial_zoom=p.attr("initial_zoom")||20;h.events=[];p.find("tr").each(function(v){var a=u(this).children(),e;if(v===0)l=a.map(function(){return u(this).attr("class").replace(/^.*?\btg-(\S+)\b.*?$/,"$1")}).get();
else{e={};a.each(function(f){c=l[f];g=c=="description"?u(this).html():u(this).text();e[c]=g});m="ev_"+b++;e.id=m;h.events.push(e)}});p.css("display","none");return h},runLoadedTimelineCallback:function(d,h,b){d.fn(h,b);if(d.load_as_only_timeline){this.activeTimelines=[];this.toggleTimeline(h[0].id)}else if(d.toggle||d.load_into_context){this.activeTimelines=[h[0].id];this.refresh()}},parseTimelineData:function(d,h){var b="";if(typeof d.presentation=="string"){timeglider.mode="presentation";b=d.timelines;
this.initial_timelines=d.initial_timelines;this.presentation={title:d.title,description:d.description,focus_date:new t.TG_Date(d.focus_date),initial_zoom:d.initial_zoom};if(typeof d.description=="string"){this.presentation.description=d.description;this.presentation.open_modal=typeof d.open_modal=="boolean"?d.open_modal:true}if(typeof d.legend=="object")this.presentation.legend=d.legend}else b=d;var l=this,c=0,g=b.length,m={};m={};for(var p=0;p<g;p++){m=b[p];m.mediator=l;m=(new t.TG_Timeline(m)).toJSON();
if(m.id.length>0){c++;l.swallowTimeline(m)}}if(h&&(typeof h.fn=="function"||typeof h=="function")){if(typeof h=="function")h={fn:h};setTimeout(function(){l.runLoadedTimelineCallback(h,b,l)},100);if(timeglider.mode!="presentation"&&(h.display||h.toggle))return false}if(c===0)alert("ERROR loading data: Check JSON with jsonLint");else{if(typeof h=="undefined")h={display:true};else if(typeof h.display=="undefined")h.display=true;this.timelineDataLoaded=true;if(h.display||h.toggle)this.tryLoading()}},
tryLoading:function(){var d=this.timelineDataLoaded==true;if(this.imagesSized==this.imagesToSize&&d){this.setInitialTimelines();if(this.timelineCollection.length==1){tl=B.timelineCollection.at(0);this.singleTimelineID=tl.get("id");this.setImageLaneHeight(tl.get("image_lane_height")||0,false,true)}u.publish(n+".mediator.timelineDataLoaded")}},swallowTimeline:function(d){this.sole_timeline_id=d.id;var h=this.timelineCollection.get(d.id);h?h.set(d):this.timelineCollection.add(d)},setInitialTimelines:function(){var d=
this;if(d.initial_timelines.length>0)d.activeTimelines=d.initial_timelines;else{var h=d.initial_timeline_id,b="";if(typeof h=="object"){b=this.initial_timeline_id[0];_.each(h,function(l){d.activeTimelines.push(l)})}else if(h.length>0){b=this.initial_timeline_id||this.sole_timeline_id;d.activeTimelines=[b]}else if(this.timelineCollection.length>0){b=this.timelineCollection.pluck("id")[0];d.activeTimelines=[b]}}if(timeglider.mode!="presentation")if(timeglider.mode=="authoring")d.setZoomLevel(40);else b?
setTimeout(function(){var l=d.timelineCollection.get(b),c=l.get("focusDateObj");d.setFocusDate(c);d.setZoomLevel(l.get("initial_zoom"))},500):d.setZoomLevel(40)},refresh:function(){u.publish(n+".mediator.refreshSignal")},setTicksReady:function(d){this.ticksReady=d;this.startSec=this._focusDate.sec;d===true&&u.publish(n+".mediator.ticksReadySignal")},setTimeoffset:function(d){this.timeOffset=x.getTimeOffset(d);this.refresh()},getTimeoffset:function(){return this.timeOffset},setDimensions:function(d){this.dimensions=
d},setFocusDate:function(d){if(d!=this._focusDate)this._focusDate=d},getFocusDate:function(){return this._focusDate},getZoomLevel:function(){return parseInt(this._zoomLevel)},mousewheelChange:function(d){var h=this.options.mousewheel;if(h==="zoom")this.viewMode=="timeline"&&this.setZoomLevel(this.getZoomLevel()+d);else h==="pan"&&u.publish(n+".mediator.mousewheelChange",{dir:d,action:"pan"})},getTagList:function(){var d={},h=[],b="";_.each(this.timelineCollection.models,function(l){l=l.get("events");
_.each(l,function(c){if(c.tags){h=c.tags.split(",");_.each(h,function(g){b=u.trim(g);if(d[b])d[b].count++;else d[b]={name:b,count:1}})}})});return d=_.sortBy(d,function(l){return l.name})},setZoomLevel:function(d){if(d<1)d=1;if(d==1||d<=this.max_zoom&&d>=this.min_zoom){this.startSec=this._focusDate.sec;if(d!=this._zoomLevel){this._zoomLevel=d;this._zoomInfo=t.zoomTree[d];u.publish(n+".mediator.zoomLevelChange");u.publish(n+".mediator.scopeChange");return true}else return false}else return false},
getZoomInfo:function(){return this._zoomInfo},getDateFromOffset:function(d){var h=this.dimensions.container;d=d-h.offset.left-h.width/2;h=this.getZoomInfo().spp;var b=this.getFocusDate().sec;return new x(Math.floor(b+-1*this.timeOffset.seconds+d*h))},registerUIEvent:function(d){switch(d.name){case "dblclick":case "dbltap":var h=this.getDateFromOffset(d.event.pageX);u.publish(n+".mediator.dblclick",{date:h,event:d.event})}},setFilters:function(d,h){switch(d.origin){case "clude":this.filters.include=
d.include;this.filters.exclude=d.exclude;break;case "title_andor_desc":this.filters.description=d.description;this.filters.title=d.title;this.filters.tags=d.tags?d.tags.split(","):[];break;case "tags":this.filters.tags=d.tags?d.tags.split(","):[];break;case "legend":var b=d.icon.replace(this.options.icon_folder,"");if(b=="all"){this.filters.legend=[];u.publish(n+".mediator.legendAll")}else if(b=="none"){this.filters.legend=["_none_.png"];u.publish(n+".mediator.legendAll")}else if(b=="provided")this.filters.legend=
h;else if(_.indexOf(this.filters.legend,b)==-1)this.filters.legend.push(b);else{var l=[];l=u.grep(this.filters.legend,function(c){return c!=b});if(i.legend.type=="checkboxes"&&l.length==0)l=["___"];this.filters.legend=l}break;case "custom":if(d.action=="add")this.filters.custom=d.fn;else delete this.filters.custom}u.publish(n+".mediator.filtersChange");this.refresh()},clearFilters:function(d){clear_legend=d.legend||false;clear_custom=d.custom||false;this.filters.exclude="";this.filters.include="";
this.filters.title="";this.filters.description="";if(clear_legend)this.filters.legend=[];if(clear_custom)this.filters.custom=""},getTicksOffset:function(){return this._ticksOffset},setTicksOffset:function(d){this._ticksOffset=d;u.publish(n+".mediator.ticksOffsetChange");u.publish(n+".mediator.scopeChange")},getTickBySerial:function(d){for(var h=this.ticksArray,b=h.length,l=0;l<b;l++){var c=h[l];if(c.serial==d)return c}return false},addToTicksArray:function(d,h){if(d.type=="init"){d.serial=x.getTimeUnitSerial(h,
d.unit);this.ticksArray=[d]}else if(d.type=="l"){d.serial=this.ticksArray[0].serial-1;this.ticksArray.unshift(d)}else{d.serial=this.ticksArray[this.ticksArray.length-1].serial+1;this.ticksArray.push(d)}u.publish(n+".mediator.ticksArrayChange");return d.serial},toggleTimeline:function(d,h){var b=h||false,l=this.timelineCollection.get(d).attributes,c=false,g=_.indexOf(this.activeTimelines,d);if(g==-1){this.activeTimelines.push(d);if(b)c=true;else{this.setFocusDate(new x(l.focus_date));this.setZoomLevel(l.initial_zoom);
if(l.initial_zoom==this.getZoomLevel())c=true}}else{this.activeTimelines.splice(g,1);c=true}c&&this.refresh();u.publish(n+".mediator.activeTimelinesChange");this.freshData=true},reportImageSize:function(d){var h=B.eventCollection.get(d.id);if(h.has("image")){if(d.error){h.attributes.image={};debug.log("WHOOPS: MISSING IMAGE: "+d.src)}else{h.attributes.image.width=d.width;h.attributes.image.height=d.height}this.imagesSized++;this.imagesSized==this.imagesToSize&&this.tryLoading()}}};t.getLowHigh=function(d){d=
_.sortBy(d,function(h){return parseInt(h)});return{low:_.first(d),high:_.last(d)}};t.validateOptions=function(d){this.optionsMaster={initial_focus:{type:"date"},timezone:{type:"timezone"},editor:{type:"string"},backgroundColor:{type:"color"},backgroundImage:{type:"color"},min_zoom:{type:"number",min:1,max:100},max_zoom:{type:"number",min:1,max:100},initial_zoom:{type:"number",min:1,max:100},show_centerline:{type:"boolean"},display_single_timeline_info:{type:"boolean"},minimum_timeline_bottom:{type:"number",
min:0,max:1E3},display_zoom_level:{type:"boolean"},data_source:{type:"url"},basic_fontsize:{type:"number",min:9,max:100},mousewheel:{type:"string",possible:["zoom","pan","none"]},initial_timeline_id:{type:"mixed"},icon_folder:{type:"string"},show_footer:{type:"boolean"},display_zoom_level:{type:"boolean"},constrain_to_data:{type:"boolean"},boost:{type:"number",min:0,max:99},event_modal:{type:"object"},event_overflow:{type:"string"},legend:{type:"object"}};var h=this,b="";u.each(d,function(l,c){if(h.optionsMaster[l])switch(h.optionsMaster[l].type){case "string":if(typeof c!=
"string")b+=l+" needs to be a string.\n";if(h.optionsMaster[l].possible)if(_.indexOf(h.optionsMaster[l].possible,c)==-1)b+=l+" must be: "+h.optionsMaster[l].possible.join(" or ");break;case "number":if(typeof c!="number")b+=c+" needs to be a number.\n";if(h.optionsMaster[l].min)if(c<h.optionsMaster[l].min)b+=l+" must be greater than or equal to "+h.optionsMaster[l].min+"\n";if(h.optionsMaster[l].max)if(c>h.optionsMaster[l].max)b+=l+" must be less than or equal to "+h.optionsMaster[l].max+"\n";break;
case "timezone":var g=/[+|-]?[0-9]+:[0-9]+/;if(_.indexOf(["New York","Denver","Chicago","Los Angeles"],c)==-1&&c.match(g)==-1)b+="The timezone is not formatted properly";break;case "boolean":if(typeof c!="boolean")b+=c+" needs to be a number.\n"}});return b}})(timeglider);(function(t){var B,x=timeglider,i,u=timeglider.TG_Date;t.widget("timeglider.timeline",{options:{base_namespace:"tg",timezone:"00:00",initial_focus:x.TG_Date.getToday(),editor:"none",min_zoom:1,max_zoom:100,show_centerline:true,data_source:"",culture:"en",base_font_size:12,mousewheel:"zoom",initial_timeline_id:"",icon_folder:"js/timeglider/icons/",image_lane_height:32,show_footer:true,use_scroller:false,minimum_timeline_bottom:24,display_zoom_level:false,display_single_timeline_info:true,initial_timeline_modal:true,
constrain_to_data:true,boost:0,tick_top:"",event_modal:{type:"default"},event_overflow:"plus",legend:{type:"default"},loaded:{display:true}},_create:function(){this._id=t(this.element).attr("id");this.element.html("<div id='tg-container' class='timeglider-container'><div class='timeglider-loading'><div>loading</div></div><div class='timeglider-centerline'></div><div class='tg-oof-count tg-oof-left'></div><div class='tg-oof-count tg-oof-right'></div><div class='timeglider-truck' id='tg-truck'><div class='timeglider-ticks noselect'><div class='timeglider-handle'></div></div></div><div class='timeglider-slider-container noselect'>\t<div class='tg-slider-plusminus tg-slider-plus tg-zoom-in'></div>\t<div class='timeglider-slider'></div>\t<div class='tg-slider-plusminus tg-slider-minus tg-zoom-out'></div>\t<div class='timeglider-pan-buttons'>\t<div class='timeglider-pan-left'></div><div class='timeglider-pan-right'></div></div></div><div class='tg-scrim'></div><div class='tg-scroller'><div class='tg-scroller-handle'></div></div><div class='timeglider-footer' id='tg-footer'>\t<div class='timeglider-logo'></div>\t<div class='tg-footer-center'>\t\t<div class='tg-prev tg-prevnext'><a>prev</a></div>\t\t<div class='tg-date-display noselect'><div class='tg-date-display-arrow'></div><span></span></div>\t\t<div class='tg-next tg-prevnext'><a>next</a></div>\t</div>\t<div class='tg-footer-buttons'>\t\t<div class='timeglider-footer-button timeglider-filter-bt'></div>\t\t<div class='timeglider-footer-button timeglider-settings-bt'></div>\t</div></div><div class='timeglider-event-hover-info'></div></div><span id='timeglider-measure-span'></span>")},
_init:function(){var w=timeglider.validateOptions(this.options);if(w==""){x.TG_Date.setCulture(this.options.culture);i=new x.TG_Mediator(this.options,this.element);this.player=B=new x.TG_TimelinePlayer(this,i);i.setFocusDate(new u(this.options.initial_focus));i.loadTimelineData(this.options.data_source,this.options.loaded)}else alert("Rats. There's a problem with your widget settings:"+w);this.element.data("timeline",this.element.data("timegliderTimeline"))},goTo:function(w,n){if(w=="next")i.gotoNextEvent();
else w=="previous"?i.gotoPreviousEvent():i.gotoDateZoom(w,n);return this},refresh:function(){i.refresh();return this},resize:function(){B.resize();return this},filterBy:function(w,n){i.filterBy(w,n);return this},addFilterAction:function(w,n,d){i.addFilterAction(w,n,d);return this},removeFilterAction:function(w){i.removeFilterAction(w);return this},getMediator:function(){return i},getEventByID:function(w,n){return i.getEventByID(w,n)},updateEvent:function(w){return i.updateEvent(w)},focusToEvent:function(w){w=
i.getEventByID(w);i.focusToEvent(w);return this},getScope:function(){return i.getScope()},fitToContainer:function(){i.fitToContainer();return this},adjustNowEvents:function(){return i.adjustNowEvents()},addEvent:function(w,n){return i.addEvent(w,n)},zoom:function(w){switch(w){case "in":w=-1;break;case "out":w=1}if(w>99||w<-99)return false;i.zoom(w);return this},loadTimeline:function(w,n,d){i.loadTimelineData(w,n,d);return this},reloadTimeline:function(w,n){i.reloadTimeline(w,n);return this},panButton:function(w,
n){var d=0;switch(n){case "left":d=30;break;case "right":d=-30;break;default:d=n}B.setPanButton(w,d)},destroy:function(){i.emptyData();t.Widget.prototype.destroy.apply(this,arguments);t(this.element).html("")}})})(jQuery);
